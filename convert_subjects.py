# -*- coding: utf-8 -*-
"""
–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç subjects.json –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –≤ –Ω—É–∂–Ω—ã–π:
- –î–æ–±–∞–≤–ª—è–µ—Ç name_key –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- –î–æ–±–∞–≤–ª—è–µ—Ç name_key –∏ title_ru –¥–ª—è —Ç–µ–º
"""

import json
import os

# –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è —Ç–µ–º –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
RUSSIAN_TOPIC_NAMES = {
    'en': [
        '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –∞–ª—Ñ–∞–≤–∏—Ç', '–ß–∏—Å–ª–∞', '–ê—Ä—Ç–∏–∫–ª–∏', '–ú–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è —Å—É–±—ä–µ–∫—Ç–∞ –∏ –æ–±—ä–µ–∫—Ç–∞',
        '–ì–ª–∞–≥–æ–ª to be', '–ì–ª–∞–≥–æ–ª to have got', '–ì–ª–∞–≥–æ–ª can', '–ü—Ä–µ–¥–ª–æ–≥–∏ –º–µ—Å—Ç–∞',
        'There is, are / There was, were', '–ü—Ä–∏—Ç—è–∂–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞–¥–µ–∂ –∏ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ',
        '–í–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞', 'Present Simple', '–ì–ª–∞–≥–æ–ª—ã love, hate, want to, let\'s',
        '–û —Å–µ–±–µ', '–ú–æ—è —Å—á–∞—Å—Ç–ª–∏–≤–∞—è —Å–µ–º—å—è', '–¶–≤–µ—Ç–∞', '–î–µ–π—Å—Ç–≤–∏—è', '–û–¥–µ–∂–¥–∞', '–ï–¥–∞',
        '–ú–æ–∏ –∏–≥—Ä—É—à–∫–∏', '–ú–æ–π –≥–æ—Ä–æ–¥/–¥–µ—Ä–µ–≤–Ω—è', '–ü—Ä–∏—Ä–æ–¥–∞, –≤—Ä–µ–º–µ–Ω–∞ –≥–æ–¥–∞', '–ü—Ä–∞–∑–¥–Ω–∏–∫–∏',
        '–•–æ–±–±–∏', '–°—á–µ—Ç–Ω—ã–µ –∏ –Ω–µ—Å—á–µ—Ç–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ', 'Past Simple', '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: much, many, a lot of',
        '–ú–æ—è —à–∫–æ–ª–∞', '–¢–µ–ª–æ', '–õ–∏—Ü–æ', '–ñ–∏–≤–æ—Ç–Ω—ã–µ –∏ –¥–æ–º–∞—à–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ', '–ú–æ–π –¥–æ–º/–∫–≤–∞—Ä—Ç–∏—Ä–∞',
        '–ú–æ–∏ –¥—Ä—É–∑—å—è', '–ú–æ–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å –∏ –≤—ã—Ö–æ–¥–Ω–æ–π', '–ü–æ–≤–µ–ª–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–∫–ª–æ–Ω–µ–Ω–∏–µ',
        'Present Continuous', '–ë—É–¥—É—â–µ–µ –∏ to be going to', '–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω—ã–µ —Å—Ç–µ–ø–µ–Ω–∏',
        '–ù–∞—Ä–µ—á–∏—è –æ–±—Ä–∞–∑–∞ –¥–µ–π—Å—Ç–≤–∏—è', 'Present Perfect'
    ],
    'kh': [
        '–ü–æ—è–≤–ª–µ–Ω–∏–µ –¥—Ä–µ–≤–Ω–µ–π—à–∏—Ö –ª—é–¥–µ–π', '–†–∞–∑–≤–∏—Ç–∏–µ –æ—Ä—É–¥–∏—è', '–î—Ä–µ–≤–Ω–µ–∫–∞–º–µ–Ω–Ω—ã–π –≤–µ–∫ (–ø–∞–ª–µ–æ–ª–∏—Ç)',
        '–°—Ä–µ–¥–Ω–µ–∫–∞–º–µ–Ω–Ω—ã–π –≤–µ–∫ (–º–µ–∑–æ–ª–∏—Ç)', '–ù–æ–≤–æ–∫–∞–º–µ–Ω–Ω—ã–π –≤–µ–∫ (–Ω–µ–æ–ª–∏—Ç)',
        '–ú–µ–¥–Ω–æ-–∫–∞–º–µ–Ω–Ω—ã–π –≤–µ–∫ (—ç–Ω–µ–æ–ª–∏—Ç)', '–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥—Ä–µ–≤–Ω–µ–π—à–∏—Ö –ª—é–¥–µ–π –æ–± –æ–∫—Ä—É–∂–∞—é—â–µ–º –º–∏—Ä–µ',
        '–≠–ø–æ—Ö–∞ –±—Ä–æ–Ω–∑—ã –∏ –µ–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏',
        '–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω–æ–π –∏ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ-–∫—É–ª—å—Ç—É—Ä–Ω–æ–π –∂–∏–∑–Ω–∏ –ª—é–¥–µ–π –≤ —ç–ø–æ—Ö—É –±—Ä–æ–Ω–∑—ã',
        '–í–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ –∫–æ—á–µ–≤–æ–≥–æ —Å–∫–æ—Ç–æ–≤–æ–¥—Å—Ç–≤–∞', '–û—Å–Ω–æ–≤—ã –∂–∏–∑–Ω–µ–æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ—á–µ–≤–æ–≥–æ —Å–∫–æ—Ç–æ–≤–æ–¥—Å—Ç–≤–∞',
        '–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—Ç—Ä–æ–π —Å–∞–∫–æ–≤ –∏ –∏—Ö —Ä–∞—Å—Å–µ–ª–µ–Ω–∏–µ'
    ],
    'kl': [
        '–ö–∞–∑–∞—Ö—Å–∫–∏–π –∞–ª—Ñ–∞–≤–∏—Ç', '–†–µ—á—å –∏ —Å–ª–æ–≤–∞—Ä—å', '–û—Å–Ω–æ–≤—ã –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏'
    ],
    'rl': [
        '–†—É—Å—Å–∫–∏–π –∞–ª—Ñ–∞–≤–∏—Ç', '–†–µ—á—å –∏ —Å–ª–æ–≤–∞—Ä—å', '–û—Å–Ω–æ–≤—ã –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏'
    ],
    'm': [
        '–ß–∏—Å–ª–∞ –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è', '–ì–µ–æ–º–µ—Ç—Ä–∏—è', '–£—Ä–∞–≤–Ω–µ–Ω–∏—è',
        '–§—É–Ω–∫—Ü–∏–∏', '–î—Ä–æ–±–∏', '–ü—Ä–æ—Ü–µ–Ω—Ç—ã'
    ],
    'p': [
        '–ú–µ—Ö–∞–Ω–∏–∫–∞', '–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ –∏ –º–∞–≥–Ω–µ—Ç–∏–∑–º', '–¢–µ–ø–ª–æ –∏ —ç–Ω–µ—Ä–≥–∏—è',
        '–í–æ–ª–Ω—ã –∏ –∑–≤—É–∫', '–û–ø—Ç–∏–∫–∞', '–ö–≤–∞–Ω—Ç–æ–≤–∞—è —Ñ–∏–∑–∏–∫–∞'
    ],
    'c': [
        '–≠–ª–µ–º–µ–Ω—Ç—ã –∏ —Å–æ—Å—Ç–∞–≤', '–•–∏–º–∏—á–µ—Å–∫–∏–µ —Ä–µ–∞–∫—Ü–∏–∏', '–û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∞—è —Ö–∏–º–∏—è',
        '–ù–µ–æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∞—è —Ö–∏–º–∏—è', '–ö–∏—Å–ª–æ—Ç—ã –∏ –æ—Å–Ω–æ–≤–∞–Ω–∏—è', '–û–∫–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∞–∫—Ü–∏–∏'
    ],
    'i': [
        '–û—Å–Ω–æ–≤—ã –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤', '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ', '–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ —Å–µ—Ç–∏',
        '–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö', '–ö–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', '–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç'
    ],
    'g': [
        '–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ó–µ–º–ª–∏', '–ö–ª–∏–º–∞—Ç –∏ –ø–æ–≥–æ–¥–∞', '–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å –∏ —ç–∫–æ–Ω–æ–º–∏–∫–∞',
        '–ù–∞—Å–µ–ª–µ–Ω–∏–µ –∏ –º–∏–≥—Ä–∞—Ü–∏—è', '–ü—Ä–∏—Ä–æ–¥–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã', '–ì–µ–æ–ø–æ–ª–∏—Ç–∏–∫–∞'
    ],
    'b': [
        '–ö–ª–µ—Ç–∫–∏ –∏ —Ç–∫–∞–Ω–∏', '–û—Ä–≥–∞–Ω—ã –æ—Ä–≥–∞–Ω–∏–∑–º–∞', '–≠–≤–æ–ª—é—Ü–∏—è –∏ –≥–µ–Ω–µ—Ç–∏–∫–∞',
        '–≠–∫–æ–ª–æ–≥–∏—è', '–ú–∏–∫—Ä–æ–±–∏–æ–ª–æ–≥–∏—è', '–§–∏–∑–∏–æ–ª–æ–≥–∏—è —á–µ–ª–æ–≤–µ–∫–∞'
    ],
    'wh': [
        '–î—Ä–µ–≤–Ω–∏–µ —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏', '–°—Ä–µ–¥–Ω–∏–µ –≤–µ–∫–∞', '–ö–æ–Ω–µ—Ü –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å—è',
        '–†–µ–Ω–µ—Å—Å–∞–Ω—Å –∏ –ü—Ä–æ—Å–≤–µ—â–µ–Ω–∏–µ', '–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è —Ä–µ–≤–æ–ª—é—Ü–∏—è', '–ù–æ–≤–∞—è –∏—Å—Ç–æ—Ä–∏—è'
    ]
}


def convert_subjects():
    """–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç subjects.json"""

    subjects_file = 'content/subjects.json'
    backup_file = 'content/subjects.json.backup'

    if not os.path.exists(subjects_file):
        print(f"‚ùå –û—à–∏–±–∫–∞: —Ñ–∞–π–ª {subjects_file} –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return

    # –î–µ–ª–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
    with open(subjects_file, 'r', encoding='utf-8') as f:
        original_data = f.read()

    with open(backup_file, 'w', encoding='utf-8') as f:
        f.write(original_data)

    print(f"üì¶ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞: {backup_file}\n")

    # –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    data = json.loads(original_data)
    subjects = data.get('subjects', [])

    print(f"üîÑ –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º {len(subjects)} –ø—Ä–µ–¥–º–µ—Ç–æ–≤...\n")

    # –ü—Ä–µ—Ñ–∏–∫—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
    prefix_map = {
        'kazakhlang': 'kl',
        'russianlang': 'rl',
        'englishlang': 'en',
        'mathematics': 'm',
        'mathematics': 'm',
        'physics': 'p',
        'chemistry': 'c',
        'informatics': 'i',
        'geography': 'g',
        'biology': 'b',
        'historykaz': 'kh',
        'worldhistory': 'wh',
    }

    # –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π –ø—Ä–µ–¥–º–µ—Ç
    for subject in subjects:
        subject_id = subject['id']

        # –î–æ–±–∞–≤–ª—è–µ–º name_key –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç–∞
        if 'name_key' not in subject:
            subject['name_key'] = subject_id

        prefix = prefix_map.get(subject_id, subject_id[:2])
        russian_titles = RUSSIAN_TOPIC_NAMES.get(prefix, [])

        topics = subject.get('topics', [])

        for idx, topic in enumerate(topics):
            # –î–æ–±–∞–≤–ª—è–µ–º name_key –¥–ª—è —Ç–µ–º—ã
            if 'name_key' not in topic:
                topic['name_key'] = f"{prefix}_topic_{idx + 1}"

            # –î–æ–±–∞–≤–ª—è–µ–º —Ä—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (title_ru)
            if idx < len(russian_titles):
                topic['title_ru'] = russian_titles[idx]
            else:
                # –ï—Å–ª–∏ —Ä—É—Å—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º
                topic['title_ru'] = f"–¢–µ–º–∞ {idx + 1}"

        print(f"‚úì {subject_id}: {len(topics)} —Ç–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–æ")

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    with open(subjects_file, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

    print(f"\n‚úÖ –§–∞–π–ª {subjects_file} —É—Å–ø–µ—à–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω!")
    print("\n–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∂–¥–æ–π —Ç–µ–º—ã —Ç–µ–ø–µ—Ä—å:")
    print('  {')
    print('    "id": "en_1",')
    print('    "name": "The Alphabet",')
    print('    "name_key": "en_topic_1",')
    print('    "title_ru": "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –∞–ª—Ñ–∞–≤–∏—Ç"')
    print('  }')


if __name__ == '__main__':
    convert_subjects()