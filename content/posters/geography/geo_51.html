<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Atmospheric Circulation - Cells and Winds</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at top, #1e3a8a, #0f172a, #020617);
            color: white; min-height: 100vh;
        }
        .heading-font { font-family: 'Montserrat', sans-serif; }
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .rounded-custom { border-radius: 2.5rem; }
        canvas { border-radius: 2rem; cursor: pointer; }
        .lang-btn.active { background: #38bdf8; color: #020617; font-weight: 800; }
        .legend-item { border-left: 3px solid transparent; padding-left: 10px; transition: all 0.3s; }
        .legend-item:hover { background: rgba(255,255,255,0.05); border-color: #38bdf8; }
    </style>
</head>
<body class="p-4 md:p-10">

<!-- –ö–ù–û–ü–ö–ê –ù–ê–ó–ê–î -->
<div style="position: fixed; top: 20px; left: 20px; z-index: 10000;">
    <button onclick="goBack()" style="
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        padding: 12px 24px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        transition: all 0.3s ease;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    " onmouseover="this.style.transform='translateX(-5px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.6)';" 
       onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)';">
        ‚Üê –ù–∞–∑–∞–¥
    </button>
</div>


    <header class="glass rounded-custom p-8 mb-8 flex flex-col md:flex-row justify-between items-center border-t border-sky-400/30">
        <div>
            <h1 id="main-title" class="heading-font text-3xl md:text-5xl uppercase tracking-tighter text-sky-300"></h1>
            <p id="sub-title" class="mt-2 text-white/40 font-light tracking-widest text-[10px] uppercase"></p>
        </div>
        <div class="flex gap-2">
            <button onclick="window.setLang('ru')" id="btn-ru" class="lang-btn px-6 py-2 rounded-xl border border-white/20 text-xs font-bold transition-all">RU</button>
            <button onclick="window.setLang('kz')" id="btn-kz" class="lang-btn px-6 py-2 rounded-xl border border-white/20 text-xs font-bold transition-all">KZ</button>
            <button onclick="window.setLang('en')" id="btn-en" class="lang-btn px-6 py-2 rounded-xl border border-white/20 text-xs font-bold transition-all">EN</button>
        </div>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-8">
        <!-- Visual Map -->
        <div class="lg:col-span-7 glass rounded-custom p-8 flex flex-col items-center justify-center relative min-h-[550px] overflow-hidden">
            <h2 id="canvas-heading" class="heading-font text-xl text-sky-200 uppercase mb-8 self-start tracking-widest opacity-60"></h2>
            <canvas id="circCanvas" class="w-full h-full"></canvas>
            <div class="absolute bottom-6 flex gap-6 text-[9px] uppercase font-bold tracking-widest text-white/30">
                <span class="text-red-400">Low Pressure (H)</span>
                <span class="text-blue-400">High Pressure (B)</span>
            </div>
        </div>

        <!-- Descriptive Info -->
        <div class="lg:col-span-5 glass rounded-custom p-10 flex flex-col justify-center border-r-4 border-sky-500">
            <h3 id="info-title" class="heading-font text-3xl mb-6 text-sky-200"></h3>
            <div id="info-text" class="text-sm font-light leading-relaxed text-white/80 space-y-6"></div>
            
            <div class="mt-8 space-y-3">
                <div class="legend-item" id="cell-h">
                    <span class="text-xs font-bold text-sky-400">–Ø—á–µ–π–∫–∞ –•—ç–¥–ª–∏:</span>
                    <p class="text-[11px] text-white/60">–í–æ—Å—Ö–æ–¥—è—â–∏–µ –ø–æ—Ç–æ–∫–∏ –Ω–∞ —ç–∫–≤–∞—Ç–æ—Ä–µ, –Ω–∏—Å—Ö–æ–¥—è—â–∏–µ –≤ —Ç—Ä–æ–ø–∏–∫–∞—Ö.</p>
                </div>
                <div class="legend-item" id="cell-f">
                    <span class="text-xs font-bold text-sky-400">–Ø—á–µ–π–∫–∞ –§–µ—Ä—Ä–µ–ª—è:</span>
                    <p class="text-[11px] text-white/60">–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å –≤–æ–∑–¥—É—Ö–∞ –≤ —É–º–µ—Ä–µ–Ω–Ω—ã—Ö —à–∏—Ä–æ—Ç–∞—Ö.</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        const translations = {
            ru: {
                title: "–ü—É–ª—å—Å –í–æ–∑–¥—É—Ö–∞", subtitle: "–ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ü–∏—Ä–∫—É–ª—è—Ü–∏—è –∏ –ø–æ—è—Å–∞ –¥–∞–≤–ª–µ–Ω–∏—è",
                canvasHeading: "–ú–æ–¥–µ–ª—å —è—á–µ–µ–∫ —Ü–∏—Ä–∫—É–ª—è—Ü–∏–∏",
                defaultTitle: "–î–≤–∏–∂–µ–Ω–∏–µ –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã",
                defaultText: "–ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω–∞—è —Ü–∏—Ä–∫—É–ª—è—Ü–∏—è ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –ø–ª–∞–Ω–µ—Ç–∞—Ä–Ω—ã—Ö –≤–µ—Ç—Ä–æ–≤. –û–Ω–∞ –≤—ã–∑–≤–∞–Ω–∞ –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º –Ω–∞–≥—Ä–µ–≤–æ–º –ó–µ–º–ª–∏ –∏ –µ—ë –≤—Ä–∞—â–µ–Ω–∏–µ–º. –¢–µ–ø–ª—ã–π –≤–æ–∑–¥—É—Ö –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –Ω–∞ —ç–∫–≤–∞—Ç–æ—Ä–µ (–ù–∏–∑–∫–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ), –æ—Ö–ª–∞–∂–¥–∞–µ—Ç—Å—è –∏ –æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ —Ç—Ä–æ–ø–∏–∫–∞—Ö (–í—ã—Å–æ–∫–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ).",
                cells: {
                    hadley: "–Ø—á–µ–π–∫–∞ –•—ç–¥–ª–∏ (–¢—Ä–æ–ø–∏–∫–∏)",
                    ferrel: "–Ø—á–µ–π–∫–∞ –§–µ—Ä—Ä–µ–ª—è (–£–º–µ—Ä–µ–Ω–Ω—ã–µ)",
                    polar: "–ü–æ–ª—è—Ä–Ω–∞—è —è—á–µ–π–∫–∞"
                },
                winds: {
                    trades: "–ü–∞—Å—Å–∞—Ç—ã (–∫ —ç–∫–≤–∞—Ç–æ—Ä—É)",
                    westerlies: "–ó–∞–ø–∞–¥–Ω—ã–µ –≤–µ—Ç—Ä—ã"
                }
            },
            kz: {
                title: "–ê—É–∞ –°–æ“ì—ã—Å—ã", subtitle: "–ñ–∞–ª–ø—ã —Ü–∏—Ä–∫—É–ª—è—Ü–∏—è –∂”ô–Ω–µ “õ—ã—Å—ã–º –±–µ–ª–¥–µ—É–ª–µ—Ä—ñ",
                canvasHeading: "–¶–∏—Ä–∫—É–ª—è—Ü–∏—è “±—è—à—ã“õ—Ç–∞—Ä—ã–Ω—ã“£ –º–æ–¥–µ–ª—ñ",
                defaultTitle: "–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ “õ–æ–∑“ì–∞–ª—ã—Å—ã",
                defaultText: "–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞–ª—ã“õ —Ü–∏—Ä–∫—É–ª—è—Ü–∏—è ‚Äî –±“±–ª –ø–ª–∞–Ω–µ—Ç–∞—Ä–ª—ã“õ –∂–µ–ª–¥–µ—Ä –∂“Ø–π–µ—Å—ñ. –û–ª –ñ–µ—Ä–¥—ñ“£ –±—ñ—Ä–∫–µ–ª–∫—ñ –∂—ã–ª—ã–Ω–±–∞—É—ã –º–µ–Ω –∞–π–Ω–∞–ª—É—ã–Ω–∞–Ω —Ç—É—ã–Ω–¥–∞–π–¥—ã. –ñ—ã–ª—ã –∞—É–∞ —ç–∫–≤–∞—Ç–æ—Ä–¥–∞ –∫”©—Ç–µ—Ä—ñ–ª–µ–¥—ñ (–¢”©–º–µ–Ω “õ—ã—Å—ã–º), —Ç—Ä–æ–ø–∏–∫—Ç–µ—Ä–¥–µ —Å—É—ã–ø —Ç”©–º–µ–Ω —Ç“Ø—Å–µ–¥—ñ (–ñ–æ“ì–∞—Ä—ã “õ—ã—Å—ã–º).",
                cells: {
                    hadley: "–•—ç–¥–ª–∏ “±—è—à—ã“ì—ã",
                    ferrel: "–§–µ—Ä—Ä–µ–ª—å “±—è—à—ã“ì—ã",
                    polar: "–ü–æ–ª—è—Ä–ª—ã“õ “±—è—à—ã“õ"
                }
            },
            en: {
                title: "Air Pulse", subtitle: "Global Circulation and Pressure Belts",
                canvasHeading: "Circulation Cell Model",
                defaultTitle: "Atmospheric Motion",
                defaultText: "Atmospheric circulation is the large-scale movement of air around the globe. It is driven by solar heating and the Earth's rotation (Coriolis effect). Rising air at the equator creates Low pressure, while sinking air in subtropics creates High pressure.",
                cells: {
                    hadley: "Hadley Cell",
                    ferrel: "Ferrel Cell",
                    polar: "Polar Cell"
                }
            }
        };

        let currentLang = 'ru', canvas, ctx;

        window.setLang = function(l) {
            currentLang = l;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${l}`).classList.add('active');
            updateUI();
        }

        function updateUI() {
            const t = translations[currentLang];
            document.getElementById('main-title').textContent = t.title;
            document.getElementById('sub-title').textContent = t.subtitle;
            document.getElementById('canvas-heading').textContent = t.canvasHeading;
            document.getElementById('info-title').textContent = t.defaultTitle;
            document.getElementById('info-text').textContent = t.defaultText;
            draw();
        }

        function draw() {
            if(!ctx) return;
            ctx.clearRect(0,0,canvas.width, canvas.height);
            const w = canvas.width, h = canvas.height;
            const time = Date.now() * 0.001;

            const cx = w/2, cy = h/2, r = 180;

            // --- Earth Sphere ---
            const grad = ctx.createRadialGradient(cx, cy, 50, cx, cy, r);
            grad.addColorStop(0, '#1e40af'); grad.addColorStop(1, '#020617');
            ctx.fillStyle = grad;
            ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2); ctx.fill();

            // --- Pressure Belts (Horizontal lines) ---
            ctx.setLineDash([5, 5]); ctx.lineWidth = 1;
            const belts = [
                {y: cy, label: 'L (–ù)', color: '#ef4444'}, // Equator
                {y: cy - r*0.4, label: 'H (–í)', color: '#60a5fa'}, // N Tropics
                {y: cy + r*0.4, label: 'H (–í)', color: '#60a5fa'}, // S Tropics
                {y: cy - r*0.8, label: 'L (–ù)', color: '#ef4444'}, // N Subpolar
                {y: cy + r*0.8, label: 'L (–ù)', color: '#ef4444'}  // S Subpolar
            ];

            belts.forEach(b => {
                ctx.strokeStyle = b.color;
                ctx.beginPath();
                const arcWidth = Math.sqrt(r*r - Math.pow(cy-b.y, 2));
                ctx.moveTo(cx - arcWidth, b.y); ctx.lineTo(cx + arcWidth, b.y);
                ctx.stroke();
                ctx.fillStyle = b.color; ctx.font = 'bold 10px Inter';
                ctx.fillText(b.label, cx + arcWidth + 10, b.y + 4);
            });
            ctx.setLineDash([]);

            // --- Circulation Cells (Vertical loops outside) ---
            ctx.lineWidth = 2;
            ctx.strokeStyle = 'rgba(255,255,255,0.2)';
            
            // Hadley (Equator-Tropics)
            drawCellLoop(cx + r + 10, cy, 30, r*0.4, time, true);
            // Ferrel (Tropics-Polar)
            drawCellLoop(cx + r + 10, cy - r*0.6, 20, r*0.3, -time, false);

            // --- Wind Arrows (Diagonal on sphere) ---
            ctx.strokeStyle = 'rgba(255,255,255,0.4)';
            for(let i=0; i<3; i++) {
                const off = i*50 - 50;
                // Trades (towards equator)
                drawArrow(cx + off, cy - 60, cx + off - 20, cy - 10);
                // Westerlies
                drawArrow(cx + off, cy - 110, cx + off + 30, cy - 150);
            }

            requestAnimationFrame(draw);
        }

        function drawCellLoop(x, y, w, h, t, clockwise) {
            ctx.beginPath();
            ctx.ellipse(x, y, w, h, 0, 0, Math.PI*2);
            ctx.stroke();
            // Arrow on loop
            const angle = t % (Math.PI*2);
            const ax = x + Math.cos(angle) * w;
            const ay = y + Math.sin(angle) * h;
            ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(ax, ay, 3, 0, Math.PI*2); ctx.fill();
        }

        function drawArrow(x1, y1, x2, y2) {
            ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
            const ang = Math.atan2(y2-y1, x2-x1);
            ctx.beginPath(); ctx.moveTo(x2,y2);
            ctx.lineTo(x2-8*Math.cos(ang-0.5), y2-8*Math.sin(ang-0.5));
            ctx.lineTo(x2-8*Math.cos(ang+0.5), y2-8*Math.sin(ang+0.5));
            ctx.fill();
        }

        window.onload = function() {
            canvas = document.getElementById('circCanvas');
            ctx = canvas.getContext('2d');
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight || 500;
            setLang('ru');
        };
    </script>

<script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script>
<script>
    function goBack() {
        console.log('goBack() –≤—ã–∑–≤–∞–Ω–∞');
        if (typeof bridge !== 'undefined' && bridge) {
            console.log('Bridge –Ω–∞–π–¥–µ–Ω, –≤—ã–∑—ã–≤–∞—é onBackClicked()');
            bridge.onBackClicked();
        } else {
            console.log('Bridge –Ω–µ –Ω–∞–π–¥–µ–Ω!');
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è QWebChannel
    document.addEventListener('DOMContentLoaded', function() {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è QWebChannel...');

        if (typeof QWebChannel !== 'undefined' && typeof qt !== 'undefined') {
            try {
                new QWebChannel(qt.webChannelTransport, function(channel) {
                    window.bridge = channel.objects.bridge;
                    console.log('‚úÖ Bridge –ø–æ–¥–∫–ª—é—á–µ–Ω!');
                });
            } catch(e) {
                console.error('‚ùå QWebChannel –æ—à–∏–±–∫–∞:', e);
            }
        } else {
            console.warn('‚ö†Ô∏è QWebChannel –∏–ª–∏ qt –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }
    });
</script>








<style data-oi-map-overlay>
.oi-map-btn{
  position:fixed; right:16px; bottom:16px; z-index:9999;
  padding:10px 14px; border-radius:999px; border:1px solid rgba(0,0,0,.15);
  background:#fff; cursor:pointer; font:600 14px/1.1 system-ui,-apple-system,Segoe UI,Roboto,Arial;
  box-shadow:0 8px 20px rgba(0,0,0,.12);
}
.oi-table-btn{
  position:fixed; right:120px; bottom:16px; z-index:9999;
  padding:10px 14px; border-radius:999px; border:1px solid rgba(0,0,0,.15);
  background:#fff; cursor:pointer; font:600 14px/1.1 system-ui,-apple-system,Segoe UI,Roboto,Arial;
  box-shadow:0 8px 20px rgba(0,0,0,.12);
}

.oi-map-backdrop{
  position:fixed; inset:0; background:rgba(0,0,0,.72); z-index:10000;
  display:none; align-items:center; justify-content:center; padding:18px;
}
.oi-map-backdrop[aria-hidden="false"]{ display:flex; }

.oi-map-modal{
  width:min(1200px, 100%); height:min(85vh, 900px);
  background:#111; border-radius:14px; overflow:hidden; position:relative;
  box-shadow:0 20px 60px rgba(0,0,0,.35);
}

.oi-map-close{
  position:absolute; top:10px; right:10px; z-index:3;
  width:40px; height:40px; border-radius:999px; border:1px solid rgba(255,255,255,.25);
  background:rgba(0,0,0,.35); color:#fff; cursor:pointer; font-size:22px;
}

.oi-map-viewport{
  width:100%; height:100%; overflow:auto; -webkit-overflow-scrolling:touch;
  touch-action: pan-x pan-y;
  background:#000;
  padding-top:62px; /* –º–µ—Å—Ç–æ –ø–æ–¥ —Ç—É–ª–±–∞—Ä */
}

.oi-map-img{
  display:block;
  transform-origin: 0 0;
  user-select:none; -webkit-user-drag:none;
}

.oi-map-toolbar{
  position:absolute; left:12px; top:12px; right:12px; z-index:2;
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  pointer-events:none;
}

.oi-map-tabs{ display:flex; gap:8px; flex-wrap:wrap; pointer-events:auto; }

.oi-map-tab{
  min-width:36px; height:34px; padding:0 10px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.22);
  background:rgba(0,0,0,.35); color:#fff;
  cursor:pointer; font:600 14px system-ui,-apple-system,Segoe UI,Roboto,Arial;
}

.oi-map-tab.is-active{
  background:rgba(255,255,255,.12);
  border-color: rgba(255,255,255,.45);
}

.oi-map-hint{
  pointer-events:none;
  color:#fff; opacity:.85; font:12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.18);
  padding:8px 10px; border-radius:10px;
}
</style>

<button class="oi-map-btn" type="button" data-oi-map-btn>üó∫Ô∏è –ö–∞—Ä—Ç–∞</button>


<div class="oi-map-backdrop" aria-hidden="true" data-oi-map-backdrop>
  <div class="oi-map-modal" role="dialog" aria-modal="true" aria-label="–ö–∞—Ä—Ç–∞">
    <button class="oi-map-close" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å" data-oi-map-close>√ó</button>

    <div class="oi-map-toolbar">
      <div class="oi-map-tabs">
        <button type="button" class="oi-map-tab is-active" data-oi-map-tab="1">1</button>
<button type="button" class="oi-map-tab" data-oi-map-tab="2">2</button>
<button type="button" class="oi-map-tab" data-oi-map-tab="3">3</button>
<button type="button" class="oi-map-tab" data-oi-map-tab="4">4</button>
<button type="button" class="oi-map-tab" data-oi-map-tab="5">5</button>
<button type="button" class="oi-map-tab" data-oi-map-tab="6">6</button>
<button type="button" class="oi-map-tab" data-oi-map-tab="7">7</button>
      </div>
      <div class="oi-map-hint">–ö–æ–ª—ë—Å–∏–∫–æ/—Ç—Ä–µ–∫–ø–∞–¥ ‚Äî –∑—É–º ‚Ä¢ Esc ‚Äî –∑–∞–∫—Ä—ã—Ç—å</div>
    </div>

    <div class="oi-map-viewport" data-oi-map-viewport>
      <img class="oi-map-img" data-oi-map-img data-map="1" src="../../assets/maps/karta_1.png" alt="map 1" style="display:block;">
<img class="oi-map-img" data-oi-map-img data-map="2" src="../../assets/maps/karta_2.png" alt="map 2" style="display:none;">
<img class="oi-map-img" data-oi-map-img data-map="3" src="../../assets/maps/karta_3.png" alt="map 3" style="display:none;">
<img class="oi-map-img" data-oi-map-img data-map="4" src="../../assets/maps/karta_4.png" alt="map 4" style="display:none;">
<img class="oi-map-img" data-oi-map-img data-map="5" src="../../assets/maps/karta_5.png" alt="map 5" style="display:none;">
<img class="oi-map-img" data-oi-map-img data-map="6" src="../../assets/maps/karta_6.png" alt="map 6" style="display:none;">
<img class="oi-map-img" data-oi-map-img data-map="7" src="../../assets/maps/karta_7.png" alt="map 7" style="display:none;">
    </div>
  </div>
</div>




<script data-oi-map-overlay>
(function(){
  // ====== MAPS ======
  const mapBtn = document.querySelector('[data-oi-map-btn]');
  const mapBackdrop = document.querySelector('[data-oi-map-backdrop]');
  const mapCloseBtn = document.querySelector('[data-oi-map-close]');
  const mapViewport = document.querySelector('[data-oi-map-viewport]');
  const mapTabs = Array.from(document.querySelectorAll('[data-oi-map-tab]'));
  const mapImgs = Array.from(document.querySelectorAll('[data-oi-map-img][data-map]'));

  // ====== MENDELEEV ======
  const tableBtn = document.querySelector('[data-oi-table-btn]');
  const tableBackdrop = document.querySelector('[data-oi-table-backdrop]');
  const tableCloseBtn = document.querySelector('[data-oi-table-close]');
  const tableViewport = document.querySelector('[data-oi-table-viewport]');
  const tableTabs = Array.from(document.querySelectorAll('[data-oi-table-tab]'));
  const tableImgs = Array.from(document.querySelectorAll('[data-oi-table-img][data-table]'));

  let scale = 1;

  function applyScale(){
    mapImgs.forEach(img => { img.style.transform = `scale(${scale})`; });
    tableImgs.forEach(img => { img.style.transform = `scale(${scale})`; });
  }

  function openBackdrop(backdrop){
    backdrop.setAttribute('aria-hidden','false');
    document.body.style.overflow = 'hidden';
  }
  function closeBackdrop(backdrop){
    backdrop.setAttribute('aria-hidden','true');
    document.body.style.overflow = '';
  }

  function showMap(n){
    mapImgs.forEach(img => {
      img.style.display = (img.getAttribute('data-map') === String(n)) ? 'block' : 'none';
    });
    mapTabs.forEach(t => t.classList.toggle('is-active', t.getAttribute('data-oi-map-tab') === String(n)));
    if(mapViewport){ mapViewport.scrollTop = 0; mapViewport.scrollLeft = 0; }
  }

  function showTable(n){
    tableImgs.forEach(img => {
      img.style.display = (img.getAttribute('data-table') === String(n)) ? 'block' : 'none';
    });
    tableTabs.forEach(t => t.classList.toggle('is-active', t.getAttribute('data-oi-table-tab') === String(n)));
    if(tableViewport){ tableViewport.scrollTop = 0; tableViewport.scrollLeft = 0; }
  }

  // MAP events
  if(mapBtn && mapBackdrop && mapCloseBtn && mapViewport && mapImgs.length){
    mapBtn.addEventListener('click', () => openBackdrop(mapBackdrop));
    mapCloseBtn.addEventListener('click', () => closeBackdrop(mapBackdrop));
    mapBackdrop.addEventListener('click', (e)=>{ if(e.target === mapBackdrop) closeBackdrop(mapBackdrop); });
    window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeBackdrop(mapBackdrop); });
    mapTabs.forEach(t => t.addEventListener('click', () => showMap(t.getAttribute('data-oi-map-tab'))));

    mapViewport.addEventListener('wheel', (e)=>{
      if(mapBackdrop.getAttribute('aria-hidden') !== 'false') return;
      e.preventDefault();
      const delta = -Math.sign(e.deltaY) * 0.1;
      scale = Math.min(4, Math.max(0.6, scale + delta));
      applyScale();
    }, {passive:false});

    showMap(1);
  }

  // TABLE events
  if(tableBtn && tableBackdrop && tableCloseBtn && tableViewport && tableImgs.length){
    tableBtn.addEventListener('click', () => openBackdrop(tableBackdrop));
    tableCloseBtn.addEventListener('click', () => closeBackdrop(tableBackdrop));
    tableBackdrop.addEventListener('click', (e)=>{ if(e.target === tableBackdrop) closeBackdrop(tableBackdrop); });
    window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeBackdrop(tableBackdrop); });
    tableTabs.forEach(t => t.addEventListener('click', () => showTable(t.getAttribute('data-oi-table-tab'))));

    tableViewport.addEventListener('wheel', (e)=>{
      if(tableBackdrop.getAttribute('aria-hidden') !== 'false') return;
      e.preventDefault();
      const delta = -Math.sign(e.deltaY) * 0.1;
      scale = Math.min(4, Math.max(0.6, scale + delta));
      applyScale();
    }, {passive:false});

    showTable(1);
  }

  applyScale();
})();
</script>
</body>
</html>