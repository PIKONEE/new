<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интерактивная Модель ДНК</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: radial-gradient(circle at center, #10141a, #000000);
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
            display: block;
        }

        /* Панель информации */
        #info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 320px;
            background: rgba(20, 20, 30, 0.9);
            backdrop-filter: blur(12px);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6);
            transform: translateX(120%);
            transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            border-left: 4px solid #00ffcc;
            z-index: 10;
            color: #d0d0d0;
        }

        #info-panel.active {
            transform: translateX(0);
        }

        #info-title {
            margin: 0 0 10px 0;
            color: #ffffff;
            font-size: 22px;
            font-weight: 600;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
            letter-spacing: 0.5px;
        }

        #info-desc {
            color: #b0b0b0;
            font-size: 15px;
            line-height: 1.6;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            border: none;
            color: #666;
            font-size: 24px;
            cursor: pointer;
            line-height: 1;
        }

        .close-btn:hover {
            color: #fff;
        }

        /* Маркер элемента */
        #zone-label {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: #00ffcc;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid rgba(0, 255, 204, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Легенда цветов */
        #legend {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            color: #ccc;
            font-size: 12px;
            pointer-events: none;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
    </style>
</head>
<body>

<div id="canvas-container"></div>
<div id="zone-label">Элемент</div>

<div id="legend">
    <div class="legend-item">
        <div class="dot" style="background:#50e3c2"></div>
        Аденин (A)
    </div>
    <div class="legend-item">
        <div class="dot" style="background:#ff5f5f"></div>
        Тимин (T)
    </div>
    <div class="legend-item">
        <div class="dot" style="background:#f5a623"></div>
        Гуанин (G)
    </div>
    <div class="legend-item">
        <div class="dot" style="background:#4a90e2"></div>
        Цитозин (C)
    </div>
</div>

<div id="info-panel">
    <button class="close-btn" onclick="closePanel()">&times;</button>
    <h2 id="info-title">Название</h2>
    <p id="info-desc">Описание</p>
</div>

<script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
</script>

<script type="module">
    import * as THREE from 'three';
    import {OrbitControls} from 'three/addons/controls/OrbitControls.js';

    // --- ДАННЫЕ ДНК ---
    const dnaData = {
        "Adenine": {
            title: "Аденин (A)",
            desc: "Пуриновое основание. В двойной спирали ДНК аденин всегда образует связь с тимином (T) через две водородные связи. Является одним из ключевых компонентов не только ДНК, но и АТФ — главного источника энергии в клетке."
        },
        "Thymine": {
            title: "Тимин (T)",
            desc: "Пиримидиновое основание. Встречается почти исключительно в ДНК (в РНК заменяется урацилом). Комплементарен аденину (A). Ошибки в спаривании тимина могут приводить к мутациям под действием ультрафиолета."
        },
        "Guanine": {
            title: "Гуанин (G)",
            desc: "Пуриновое основание. Образует прочную тройную водородную связь с цитозином (C), что делает участки ДНК с высоким содержанием G-C пар более стабильными и тугоплавкими."
        },
        "Cytosine": {
            title: "Цитозин (C)",
            desc: "Пиримидиновое основание. Комплементарен гуанину (G). Цитозин часто подвергается метилированию в клетках, что является важным эпигенетическим механизмом регуляции активности генов."
        },
        "Backbone": {
            title: "Сахаро-фосфатный остов",
            desc: "Внешний каркас спирали ДНК. Состоит из чередующихся молекул дезоксирибозы (сахар) и фосфатных групп. Остов заряжен отрицательно, что придает ДНК кислотные свойства и позволяет ей связываться с белками-гистонами."
        }
    };

    // Цвета (Biochemistry conventions)
    const COLORS = {
        A: 0x50e3c2, // Greenish/Teal
        T: 0xff5f5f, // Red
        G: 0xf5a623, // Orange/Yellow
        C: 0x4a90e2, // Blue
        Backbone: 0xe0e0e0 // White/Grey
    };

    // --- СЦЕНА ---
    const container = document.getElementById('canvas-container');
    const scene = new THREE.Scene();
    // Добавляем туман для глубины (делаем его менее плотным, чтобы не скрывал модель)
    scene.fog = new THREE.FogExp2(0x10141a, 0.002);

    // Увеличиваем дальность прорисовки (far clipping plane) с 100 до 2000
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 2000);
    camera.position.set(0, 0, 25);

    const renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    // Включаем свечение (эмиссию)
    renderer.toneMapping = THREE.ReinhardToneMapping;
    container.appendChild(renderer.domElement);

    // --- ОСВЕЩЕНИЕ ---
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
    scene.add(ambientLight);

    const pointLight = new THREE.PointLight(0xffffff, 1, 100);
    pointLight.position.set(10, 10, 10);
    scene.add(pointLight);

    const blueLight = new THREE.PointLight(0x0055ff, 2, 50);
    blueLight.position.set(-10, -5, 5);
    scene.add(blueLight);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.autoRotate = true;
    controls.autoRotateSpeed = 1.0;
    // Ограничиваем максимальное отдаление
    controls.maxDistance = 200;

    // --- ГЕНЕРАЦИЯ ДНК ---
    const dnaGroup = new THREE.Group();
    scene.add(dnaGroup);

    // Материалы (используем MeshPhysicalMaterial для красивых бликов)
    const baseMaterial = new THREE.MeshPhysicalMaterial({
        roughness: 0.3,
        metalness: 0.1,
        reflectivity: 0.8,
        clearcoat: 0.5,
        clearcoatRoughness: 0.2
    });

    const backboneMaterial = new THREE.MeshPhysicalMaterial({
        color: COLORS.Backbone,
        roughness: 0.4,
        metalness: 0.3,
        clearcoat: 0.2
    });

    // Параметры спирали
    const numPairs = 30;
    const radius = 3.5;
    const heightStep = 0.8;
    const twist = 0.6; // Радианы поворота на шаг (~34 градуса)
    const startY = -(numPairs * heightStep) / 2;

    // Геометрии (переиспользуем для оптимизации)
    const sphereGeo = new THREE.SphereGeometry(0.6, 32, 32);
    const bondGeo = new THREE.CylinderGeometry(0.2, 0.2, radius * 1.8, 16);
    const baseGeo = new THREE.CapsuleGeometry(0.4, 1.2, 4, 16);

    // Создаем пары
    for (let i = 0; i < numPairs; i++) {
        const angle = i * twist;
        const y = startY + i * heightStep;

        // Координаты двух нитей
        const x1 = Math.cos(angle) * radius;
        const z1 = Math.sin(angle) * radius;

        const x2 = Math.cos(angle + Math.PI) * radius; // Вторая нить сдвинута на 180 градусов
        const z2 = Math.sin(angle + Math.PI) * radius;

        // --- 1. ОСТОВ (Шарики Backbone) ---
        const bb1 = new THREE.Mesh(sphereGeo, backboneMaterial.clone());
        bb1.position.set(x1, y, z1);
        bb1.name = "Backbone";
        dnaGroup.add(bb1);

        const bb2 = new THREE.Mesh(sphereGeo, backboneMaterial.clone());
        bb2.position.set(x2, y, z2);
        bb2.name = "Backbone";
        dnaGroup.add(bb2);

        // Соединяем шарики остова трубками (для цельности)
        if (i > 0) {
            const prevAngle = (i - 1) * twist;
            const prevY = startY + (i - 1) * heightStep;
            const px1 = Math.cos(prevAngle) * radius;
            const pz1 = Math.sin(prevAngle) * radius;

            // Векторная математика для трубок между шариками
            // Здесь упростим: просто много сфер создают иллюзию цепи
            // Или можно добавить cylinder между текущим и предыдущим
        }

        // --- 2. АЗОТИСТЫЕ ОСНОВАНИЯ ---
        // Случайный выбор пары: 0 = A-T, 1 = T-A, 2 = G-C, 3 = C-G
        const pairType = Math.floor(Math.random() * 4);
        let leftBaseType, rightBaseType;

        switch (pairType) {
            case 0:
                leftBaseType = 'Adenine';
                rightBaseType = 'Thymine';
                break;
            case 1:
                leftBaseType = 'Thymine';
                rightBaseType = 'Adenine';
                break;
            case 2:
                leftBaseType = 'Guanine';
                rightBaseType = 'Cytosine';
                break;
            case 3:
                leftBaseType = 'Cytosine';
                rightBaseType = 'Guanine';
                break;
        }

        // Создаем половинку базы (левая)
        const leftMat = baseMaterial.clone();
        leftMat.color.setHex(COLORS[leftBaseType.charAt(0)]); // Берем первую букву для словаря цветов

        const leftBase = new THREE.Mesh(baseGeo, leftMat);
        // Поворачиваем и позиционируем
        leftBase.position.set(x1 * 0.5, y, z1 * 0.5); // На полпути к центру
        leftBase.lookAt(0, y, 0); // Смотрит в центр
        leftBase.rotateX(Math.PI / 2); // Кладем горизонтально
        leftBase.name = leftBaseType;
        dnaGroup.add(leftBase);

        // Создаем половинку базы (правая)
        const rightMat = baseMaterial.clone();
        rightMat.color.setHex(COLORS[rightBaseType.charAt(0)]);

        const rightBase = new THREE.Mesh(baseGeo, rightMat);
        rightBase.position.set(x2 * 0.5, y, z2 * 0.5);
        rightBase.lookAt(0, y, 0);
        rightBase.rotateX(Math.PI / 2);
        rightBase.name = rightBaseType;
        dnaGroup.add(rightBase);

        // Водородная связь (Тонкая перемычка в центре)
        const bond = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, 0.6, 8), backboneMaterial);
        bond.position.set(0, y, 0);
        bond.lookAt(x1, y, z1);
        bond.rotateX(Math.PI / 2);
        dnaGroup.add(bond);
    }

    // --- ИНТЕРАКТИВНОСТЬ ---
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    let highlightedObj = null;
    let originalHex = null;

    const panel = document.getElementById('info-panel');
    const titleEl = document.getElementById('info-title');
    const descEl = document.getElementById('info-desc');
    const labelEl = document.getElementById('zone-label');

    window.addEventListener('mousemove', onMouseMove);
    window.addEventListener('click', onClick);

    function onMouseMove(event) {
        // Остановка вращения при наведении? Можно, но лучше оставить для динамики
        // controls.autoRotate = false;

        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(dnaGroup.children);

        if (intersects.length > 0) {
            const obj = intersects[0].object;
            // Игнорируем мелкие связующие элементы без имени
            if (obj.name && dnaData[obj.name]) {
                labelEl.textContent = dnaData[obj.name].title;
                labelEl.style.opacity = 1;
                document.body.style.cursor = 'pointer';

                // Легкая подсветка без клика (опционально)
                return;
            }
        }

        labelEl.style.opacity = 0;
        document.body.style.cursor = 'default';
    }

    function onClick(event) {
        if (event.target.closest('#info-panel') || event.target.closest('.close-btn')) return;

        // Сброс предыдущей подсветки
        if (highlightedObj) {
            highlightedObj.material.emissive.setHex(0x000000);
            highlightedObj = null;
        }

        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(dnaGroup.children);

        if (intersects.length > 0) {
            const obj = intersects[0].object;
            if (obj.name && dnaData[obj.name]) {
                // Подсветка
                highlightedObj = obj;
                obj.material.emissive.setHex(0x444444); // Добавляем свечение

                showInfo(obj.name);
            }
        } else {
            closePanel();
        }
    }

    function showInfo(key) {
        const data = dnaData[key];
        titleEl.textContent = data.title;
        descEl.textContent = data.desc;

        // Красим границу панели в цвет элемента
        let colorHex = '#ffffff';
        if (key === 'Adenine') colorHex = '#50e3c2';
        else if (key === 'Thymine') colorHex = '#ff5f5f';
        else if (key === 'Guanine') colorHex = '#f5a623';
        else if (key === 'Cytosine') colorHex = '#4a90e2';

        panel.style.borderLeftColor = colorHex;
        panel.classList.add('active');
    }

    window.closePanel = function () {
        panel.classList.remove('active');
        if (highlightedObj) {
            highlightedObj.material.emissive.setHex(0x000000);
            highlightedObj = null;
        }
    };

    // --- АНИМАЦИЯ ---
    function animate() {
        requestAnimationFrame(animate);
        controls.update();

        // Легкое "дыхание" молекулы
        const time = Date.now() * 0.001;
        dnaGroup.position.y = Math.sin(time) * 0.5;

        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    animate();
</script>
</body>
</html>