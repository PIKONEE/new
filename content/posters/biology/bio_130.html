<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mineral Nutrition of Plants</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600&family=Playfair+Display:ital,wght@1,700&display=swap" rel="stylesheet">
    <style>
        body { background: #1e1b4b; color: #e0e7ff; font-family: 'Inter'; min-height: 100vh; }
        .glass { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); }
        .rounded-custom { border-radius: 2rem; }
        .lang-btn.active { background: #818cf8; color: #1e1b4b; font-weight: 800; }
        canvas { cursor: crosshair; border-radius: 1.5rem; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body class="p-8">

<!-- КНОПКА НАЗАД -->
<div style="position: fixed; top: 20px; left: 20px; z-index: 10000;">
    <button onclick="goBack()" style="
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        padding: 12px 24px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        transition: all 0.3s ease;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    " onmouseover="this.style.transform='translateX(-5px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.6)';" 
       onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)';">
        ← Назад
    </button>
</div>


    <header class="flex justify-between items-center mb-8 border-b border-indigo-500/30 pb-4">
        <div>
            <h1 id="title" class="text-4xl font-bold text-indigo-300 font-serif italic"></h1>
            <p class="text-xs uppercase tracking-[0.3em] text-indigo-400 mt-2 opacity-70">Root Pressure & Osmosis</p>
        </div>
        <div class="flex gap-2">
            <button onclick="setL('ru')" id="btn-ru" class="lang-btn px-4 py-1 rounded text-xs border border-white/20">RU</button>
            <button onclick="setL('kz')" id="btn-kz" class="lang-btn px-4 py-1 rounded text-xs border border-white/20">KZ</button>
            <button onclick="setL('en')" id="btn-en" class="lang-btn px-4 py-1 rounded text-xs border border-white/20">EN</button>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
        <div class="glass rounded-custom p-8 relative h-[500px]">
            <canvas id="rootCanvas" class="w-full h-full bg-black/20"></canvas>
            <div class="absolute top-4 left-4 flex gap-2">
                <span class="px-3 py-1 bg-blue-500/20 text-blue-300 text-xs rounded-full border border-blue-500/50">H₂O Osmosis</span>
                <span class="px-3 py-1 bg-yellow-500/20 text-yellow-300 text-xs rounded-full border border-yellow-500/50">Active Transport (Ions)</span>
            </div>
        </div>

        <div class="flex flex-col gap-6">
            <div class="glass p-8 rounded-custom border-l-4 border-indigo-500">
                <h2 id="h-main" class="text-2xl font-bold mb-4 text-white"></h2>
                <p id="t-main" class="text-sm leading-relaxed text-indigo-100/80"></p>
            </div>

            <div class="grid grid-cols-1 gap-3">
                <div class="glass p-5 rounded-xl flex items-center gap-4">
                    <div class="text-2xl font-bold text-green-400">N</div>
                    <div>
                        <div class="text-xs uppercase text-gray-400 font-bold" id="l-nitro">Nitrogen</div>
                        <div class="text-xs text-gray-300" id="d-nitro">Growth of leaves and stems</div>
                    </div>
                </div>
                <div class="glass p-5 rounded-xl flex items-center gap-4">
                    <div class="text-2xl font-bold text-orange-400">P</div>
                    <div>
                        <div class="text-xs uppercase text-gray-400 font-bold" id="l-phos">Phosphorus</div>
                        <div class="text-xs text-gray-300" id="d-phos">Flowering and fruiting</div>
                    </div>
                </div>
                <div class="glass p-5 rounded-xl flex items-center gap-4">
                    <div class="text-2xl font-bold text-purple-400">K</div>
                    <div>
                        <div class="text-xs uppercase text-gray-400 font-bold" id="l-pot">Potassium</div>
                        <div class="text-xs text-gray-300" id="d-pot">Roots and winter hardiness</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const content = {
            ru: {
                title: "Минеральное Питание",
                h: "Почвенное питание",
                d: "Растения поглощают из почвы воду и растворенные минеральные соли с помощью корневых волосков. Вода поступает пассивно (осмос), а ионы — активно (с затратой энергии). Корневое давление толкает раствор вверх.",
                n: "Азот", nd: "Рост листьев и стеблей (вегетативная масса).",
                p: "Фосфор", pd: "Цветение, плодоношение и созревание семян.",
                k: "Калий", kd: "Развитие корней, устойчивость к холоду и болезням."
            },
            kz: {
                title: "Минералды Қоректену",
                h: "Топырақтық қоректену",
                d: "Өсімдіктер топырақтан су мен еріген минералды тұздарды тамыр түктері арқылы сіңіреді. Су пассивті түрде (осмос), ал иондар — белсенді түрде (энергия жұмсау арқылы) енеді. Тамыр қысымы ерітіндіні жоғары итереді.",
                n: "Азот", nd: "Жапырақтар мен сабақтардың өсуі.",
                p: "Фосфор", pd: "Гүлдену және жеміс беру.",
                k: "Калий", kd: "Тамыр дамуы, суыққа төзімділік."
            },
            en: {
                title: "Mineral Nutrition",
                h: "Soil Nutrition",
                d: "Plants absorb water and dissolved mineral salts from the soil via root hairs. Water enters passively (osmosis), while ions enter actively (requiring energy). Root pressure pushes the solution upward.",
                n: "Nitrogen", nd: "Growth of leaves and stems.",
                p: "Phosphorus", pd: "Flowering and fruiting.",
                k: "Potassium", kd: "Root development and hardiness."
            }
        };

        let lang='ru', cx, cvs;
        let ions = [];

        window.setL = (l) => {
            lang = l;
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-'+l).classList.add('active');
            const d = content[l];
            document.getElementById('title').textContent = d.title;
            document.getElementById('h-main').textContent = d.h;
            document.getElementById('t-main').textContent = d.d;
            document.getElementById('l-nitro').textContent = d.n; document.getElementById('d-nitro').textContent = d.nd;
            document.getElementById('l-phos').textContent = d.p; document.getElementById('d-phos').textContent = d.pd;
            document.getElementById('l-pot').textContent = d.k; document.getElementById('d-pot').textContent = d.kd;
        }

        function draw() {
            const w = cvs.width, h = cvs.height;
            cx.clearRect(0,0,w,h);
            
            // Soil
            cx.fillStyle = '#292524'; cx.fillRect(0,0,w,h);
            
            // Root Hair (Zoomed)
            cx.fillStyle = '#a16207'; 
            cx.beginPath();
            cx.moveTo(w*0.4, 0); 
            cx.quadraticCurveTo(w*0.4, h*0.8, w*0.8, h*0.8);
            cx.quadraticCurveTo(w*0.8, 0, w*0.9, 0);
            cx.lineTo(w, 0); cx.lineTo(w, h); cx.lineTo(0, h); cx.lineTo(0, 0);
            cx.fill(); // Masking outside

            // Actual Root Hair shape
            cx.fillStyle = '#fbbf24'; // Inside cell
            cx.beginPath();
            cx.moveTo(w*0.4, 0); 
            cx.quadraticCurveTo(w*0.4, h*0.8, w*0.8, h*0.8);
            cx.quadraticCurveTo(w*0.8, 0, w*0.9, 0);
            cx.fill();

            // Ion particles
            if (Math.random() > 0.9) {
                ions.push({
                    x: Math.random() * w * 0.3,
                    y: Math.random() * h,
                    vx: 1 + Math.random(),
                    t: Math.random() > 0.5 ? 'H2O' : 'ION'
                });
            }

            ions.forEach((p, i) => {
                p.x += p.vx;
                // Move towards root hair
                if(p.x > w*0.4 && p.y < h*0.8) {
                    p.x += 1; p.y -= 2; // Up the root
                    if (p.y < 0) ions.splice(i, 1);
                } else if (p.x > w) {
                    ions.splice(i, 1);
                }

                cx.fillStyle = p.t === 'H2O' ? '#60a5fa' : '#facc15';
                cx.beginPath(); cx.arc(p.x, p.y, p.t === 'H2O' ? 3 : 5, 0, Math.PI*2); cx.fill();
                if(p.t === 'ION') {
                    cx.fillStyle = 'black'; cx.font = '8px Arial'; cx.fillText('+', p.x-2, p.y+3);
                }
            });

            requestAnimationFrame(draw);
        }

        window.onload = () => {
            cvs = document.getElementById('rootCanvas'); cx = cvs.getContext('2d');
            const rs = () => { cvs.width = cvs.parentElement.clientWidth; cvs.height = cvs.parentElement.clientHeight; };
            window.addEventListener('resize', rs); rs();
            setL('ru'); draw();
        };
    </script>

<script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script>
<script>
    function goBack() {
        console.log('goBack() вызвана');
        if (typeof bridge !== 'undefined' && bridge) {
            console.log('Bridge найден, вызываю onBackClicked()');
            bridge.onBackClicked();
        } else {
            console.log('Bridge не найден!');
        }
    }

    // Инициализация QWebChannel
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Инициализация QWebChannel...');

        if (typeof QWebChannel !== 'undefined' && typeof qt !== 'undefined') {
            try {
                new QWebChannel(qt.webChannelTransport, function(channel) {
                    window.bridge = channel.objects.bridge;
                    console.log('✅ Bridge подключен!');
                });
            } catch(e) {
                console.error('❌ QWebChannel ошибка:', e);
            }
        } else {
            console.warn('⚠️ QWebChannel или qt не найден');
        }
    });
</script>

</body>
</html>