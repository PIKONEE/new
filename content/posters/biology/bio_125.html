<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shoot Modifications</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600&family=Playfair+Display:ital,wght@1,700&display=swap" rel="stylesheet">
    <style>
        body { background: #3f2c22; color: #fde68a; min-height: 100vh; font-family: 'Inter'; }
        .serif { font-family: 'Playfair Display', serif; }
        .glass { background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); border-radius: 1.5rem; }
        .rounded-custom { border-radius: 2rem; }
        canvas { border-radius: 1.5rem; cursor: pointer; }
        .mod-btn { transition: 0.3s; opacity: 0.6; }
        .mod-btn:hover, .mod-btn.active { opacity: 1; transform: scale(1.05); color: #fff; border-color: #facc15; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body class="p-8">

<!-- КНОПКА НАЗАД -->
<div style="position: fixed; top: 20px; left: 20px; z-index: 10000;">
    <button onclick="goBack()" style="
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        padding: 12px 24px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        transition: all 0.3s ease;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    " onmouseover="this.style.transform='translateX(-5px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.6)';" 
       onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)';">
        ← Назад
    </button>
</div>


    <header class="flex justify-between items-center mb-10 border-b border-yellow-500/30 pb-4">
        <div>
            <h1 id="title" class="serif text-4xl text-yellow-200"></h1>
            <p class="text-xs uppercase tracking-widest text-yellow-500/60 mt-2">Underground Treasure</p>
        </div>
        <div class="flex gap-2 text-xs font-bold">
            <button onclick="window.setL('ru')" class="bg-yellow-900 px-3 py-1 rounded hover:bg-yellow-700">RU</button>
            <button onclick="window.setL('kz')" class="bg-yellow-900 px-3 py-1 rounded hover:bg-yellow-700">KZ</button>
            <button onclick="window.setL('en')" class="bg-yellow-900 px-3 py-1 rounded hover:bg-yellow-700">EN</button>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="glass p-6 flex flex-col gap-4">
            <h3 class="text-yellow-400 uppercase text-xs font-bold tracking-widest mb-2">Select Type</h3>
            <button onclick="window.setMode('rhizome')" id="btn-rhizome" class="mod-btn border-l-4 border-transparent p-4 text-left glass rounded-xl">Rhizome</button>
            <button onclick="window.setMode('tuber')" id="btn-tuber" class="mod-btn border-l-4 border-transparent p-4 text-left glass rounded-xl">Tuber</button>
            <button onclick="window.setMode('bulb')" id="btn-bulb" class="mod-btn border-l-4 border-transparent p-4 text-left glass rounded-xl">Bulb</button>
        </div>

        <div class="lg:col-span-2 relative h-[500px] glass p-0 overflow-hidden flex items-center justify-center bg-black/20">
            <canvas id="modCanvas" class="w-full h-full"></canvas>
            
            <div class="absolute bottom-8 left-8 right-8 glass p-6 border-l-4 border-yellow-500 transition-all duration-500" id="info-box">
                <h2 id="info-h" class="text-2xl font-bold text-white mb-2"></h2>
                <p id="info-d" class="text-sm text-white/70 leading-relaxed"></p>
            </div>
        </div>
    </div>

    <script>
        const bio7Data = {
            ru: {
                t: "Видоизменения Побега",
                modes: {
                    rhizome: {t: "Корневище", d: "Подземный побег с чешуевидными листьями и почками. Служит для запасания веществ и вегетативного размножения (Ландыш, Ирис, Пырей)."},
                    tuber: {t: "Клубень", d: "Утолщенный подземный побег. Глазки — это почки. Основная функция — запас крахмала (Картофель, Топинамбур)."},
                    bulb: {t: "Луковица", d: "Укороченный стебель (донце) с сочными листьями (чешуями). Запас воды и сахаров (Лук, Тюльпан, Лилия)."}
                },
                ui: {rhizome:"Корневище", tuber:"Клубень", bulb:"Луковица"}
            },
            kz: {
                t: "Өркеннің Түрөзгерістері",
                modes: {
                    rhizome: {t: "Тамырсабақ", d: "Қабыршақ жапырақтары мен бүршіктері бар жер асты өркені. Қорек жинау және көбею үшін қызмет етеді (Інжугүл, Құртқашаш)."},
                    tuber: {t: "Түйнек", d: "Жуандаған жер асты өркені. Көзшелері — бүршіктер. Негізгі қызметі — крахмал жинау (Картоп, Топинамбур)."},
                    bulb: {t: "Пиязшық", d: "Шырынды жапырақтары (қабыршақтары) бар қысқарған сабақ (түбіртек). Су мен қант қоры (Пияз, Қызғалдақ)."}
                },
                ui: {rhizome:"Тамырсабақ", tuber:"Түйнек", bulb:"Пиязшық"}
            },
            en: {
                t: "Shoot Modifications",
                modes: {
                    rhizome: {t: "Rhizome", d: "Underground stem with scale-like leaves and buds. Used for storage and vegetative reproduction (Lily of the valley, Ginger)."},
                    tuber: {t: "Tuber", d: "Swollen underground stem. 'Eyes' are buds. Main function is starch storage (Potato, Jerusalem artichoke)."},
                    bulb: {t: "Bulb", d: "Shortened stem (basal plate) with fleshy leaves (scales). Stores water and sugars (Onion, Tulip)."}
                },
                ui: {rhizome:"Rhizome", tuber:"Tuber", bulb:"Bulb"}
            }
        };

        let lang='ru', mode='tuber', ctx, cvs;

        window.setL = (l) => {
            lang = l;
            document.getElementById('title').textContent = bio7Data[l].t;
            document.getElementById('btn-rhizome').textContent = bio7Data[l].ui.rhizome;
            document.getElementById('btn-tuber').textContent = bio7Data[l].ui.tuber;
            document.getElementById('btn-bulb').textContent = bio7Data[l].ui.bulb;
            updateInfo();
        }

        window.setMode = (m) => { mode = m; updateInfo(); }

        function updateInfo() {
            const d = bio7Data[lang].modes[mode];
            document.getElementById('info-h').textContent = d.t;
            document.getElementById('info-d').textContent = d.d;
            document.querySelectorAll('.mod-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-'+mode).classList.add('active');
            draw();
        }

        function draw() {
            if(!ctx) return;
            const w = cvs.width, h = cvs.height;
            const cx = w/2, cy = h/2;
            ctx.clearRect(0,0,w,h);

            // Soil
            ctx.fillStyle = '#292524'; ctx.fillRect(0,0,w,h);

            if (mode === 'tuber') {
                // Potato
                ctx.fillStyle = '#ca8a04';
                ctx.beginPath(); ctx.ellipse(cx, cy, 100, 70, 0.2, 0, Math.PI*2); ctx.fill();
                // Eyes
                ctx.fillStyle = '#713f12';
                [[cx-40, cy-20], [cx+50, cy-10], [cx, cy+40]].forEach(p => {
                    ctx.beginPath(); ctx.arc(p[0], p[1], 5, 0, Math.PI*2); ctx.fill();
                    // Sprout
                    ctx.strokeStyle = '#bef264'; ctx.lineWidth = 2;
                    ctx.beginPath(); ctx.moveTo(p[0], p[1]); ctx.quadraticCurveTo(p[0]+10, p[1]-20, p[0]+20, p[1]-10); ctx.stroke();
                });
            } else if (mode === 'bulb') {
                // Onion layers
                for(let i=6; i>0; i--) {
                    ctx.fillStyle = i%2===0 ? '#7c2d12' : '#fcd34d';
                    ctx.beginPath(); ctx.arc(cx, cy+50, 20 + i*15, Math.PI, 0); 
                    ctx.bezierCurveTo(cx+20+i*15, cy-50-i*10, cx, cy-100-i*20, cx, cy-150);
                    ctx.bezierCurveTo(cx, cy-100-i*20, cx-20-i*15, cy-50-i*10, cx-20-i*15, cy+50);
                    ctx.fill();
                }
                // Basal plate
                ctx.fillStyle = '#fff'; ctx.fillRect(cx-20, cy+50, 40, 10);
                // Roots
                ctx.strokeStyle = '#fff';
                for(let i=0; i<10; i++) {
                    ctx.beginPath(); ctx.moveTo(cx-15+i*3, cy+60); ctx.lineTo(cx-20+i*4 + (Math.random()-0.5)*10, cy+100); ctx.stroke();
                }
            } else {
                // Rhizome (Ginger-like)
                ctx.fillStyle = '#a16207';
                ctx.beginPath();
                ctx.arc(cx-60, cy, 30, 0, Math.PI*2);
                ctx.arc(cx, cy+20, 35, 0, Math.PI*2);
                ctx.arc(cx+70, cy-10, 30, 0, Math.PI*2);
                ctx.fill();
                // Scale leaves
                ctx.fillStyle = '#713f12';
                ctx.beginPath(); ctx.arc(cx, cy+20, 35, 0, Math.PI, true); ctx.stroke();
            }
        }

        window.onload = () => {
            cvs = document.getElementById('modCanvas'); cx = cvs.getContext('2d');
            const rs = () => { cvs.width = cvs.parentElement.clientWidth; cvs.height = cvs.parentElement.clientHeight || 500; updateInfo(); };
            window.addEventListener('resize', rs); rs();
            window.setL('ru');
        };
    </script>

<script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script>
<script>
    function goBack() {
        console.log('goBack() вызвана');
        if (typeof bridge !== 'undefined' && bridge) {
            console.log('Bridge найден, вызываю onBackClicked()');
            bridge.onBackClicked();
        } else {
            console.log('Bridge не найден!');
        }
    }

    // Инициализация QWebChannel
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Инициализация QWebChannel...');

        if (typeof QWebChannel !== 'undefined' && typeof qt !== 'undefined') {
            try {
                new QWebChannel(qt.webChannelTransport, function(channel) {
                    window.bridge = channel.objects.bridge;
                    console.log('✅ Bridge подключен!');
                });
            } catch(e) {
                console.error('❌ QWebChannel ошибка:', e);
            }
        } else {
            console.warn('⚠️ QWebChannel или qt не найден');
        }
    });
</script>

</body>
</html>