<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Солнечная Система</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #000;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
            display: block;
        }

        /* Панель информации */
        #info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 340px;
            background: rgba(10, 15, 30, 0.9);
            backdrop-filter: blur(12px);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 0 40px rgba(255, 200, 50, 0.1);
            transform: translateX(120%);
            transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            border-left: 4px solid #ffd700;
            z-index: 10;
            color: #d0d0d0;
        }

        #info-panel.active {
            transform: translateX(0);
        }

        #info-title {
            margin: 0 0 10px 0;
            color: #ffffff;
            font-size: 24px;
            font-weight: 600;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }

        #info-desc {
            color: #b0c4de;
            font-size: 15px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .info-stat {
            font-size: 13px;
            color: #8899a6;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        .info-stat span {
            color: #fff;
            font-weight: 500;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            border: none;
            color: #666;
            font-size: 24px;
            cursor: pointer;
            line-height: 1;
        }

        .close-btn:hover {
            color: #fff;
        }

        /* Маркер названия планеты при наведении */
        #planet-label {
            position: absolute;
            top: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 5px 12px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            transform: translate(-50%, -150%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            white-space: nowrap;
        }

        /* Заголовок сверху */
        #main-title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-family: 'Segoe UI', sans-serif;
            font-size: 28px;
            font-weight: 300;
            letter-spacing: 6px;
            text-transform: uppercase;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            pointer-events: none;
            z-index: 5;
            text-align: center;
            width: 100%;
        }

        /* Инструкция внизу */
        #controls-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
            pointer-events: none;
        }

    </style>
</head>
<body>

<h1 id="main-title">Солнечная Система</h1>
<div id="controls-hint">Кликните по планете для информации • Колесо мыши для зума • ЛКМ для вращения</div>

<div id="canvas-container"></div>
<div id="planet-label">Земля</div>

<div id="info-panel">
    <button class="close-btn" onclick="closePanel()">&times;</button>
    <h2 id="info-title">Название</h2>
    <div id="info-stats">
        <!-- Сюда вставляются данные -->
    </div>
    <p id="info-desc">Описание</p>
</div>

<script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
</script>

<script type="module">
    import * as THREE from 'three';
    import {OrbitControls} from 'three/addons/controls/OrbitControls.js';

    // --- ДАННЫЕ О ПЛАНЕТАХ ---
    const solarSystemData = {
        "Sun": {
            name: "Солнце",
            desc: "Звезда, вокруг которой вращается наша планетная система.",
            type: "Звезда",
            radius: 5,
            distance: 0,
            speed: 0,
            color: 0xffaa00,
            textureType: "sun"
        },
        "Mercury": {
            name: "Меркурий",
            desc: "Самая маленькая и ближайшая к Солнцу планета. Покрыта кратерами.",
            type: "Планета земной группы",
            radius: 0.6,
            distance: 9,
            speed: 0.04,
            color: 0x8c8c8c, // Серый
            textureType: "terrestrial"
        },
        "Venus": {
            name: "Венера",
            desc: "Самая горячая планета. Плотная атмосфера скрывает поверхность.",
            type: "Планета земной группы",
            radius: 1.1,
            distance: 13,
            speed: 0.015,
            color: 0xe3bb76, // Бежевый
            textureType: "atmosphere"
        },
        "Earth": {
            name: "Земля",
            desc: "Наш дом. Единственная планета с жидкой водой на поверхности.",
            type: "Планета земной группы",
            radius: 1.2,
            distance: 18,
            speed: 0.01,
            color: 0x1144cc, // Синий океан
            textureType: "earth"
        },
        "Mars": {
            name: "Марс",
            desc: "«Красная планета». Поверхность богата оксидом железа.",
            type: "Планета земной группы",
            radius: 0.8,
            distance: 23,
            speed: 0.008,
            color: 0xdd4422, // Ржавый
            textureType: "terrestrial"
        },
        "Jupiter": {
            name: "Юпитер",
            desc: "Газовый гигант с характерными полосами ветров.",
            type: "Газовый гигант",
            radius: 2.8,
            distance: 34,
            speed: 0.004,
            color: 0xd8ca9d,
            textureType: "gas"
        },
        "Saturn": {
            name: "Сатурн",
            desc: "Газовый гигант с великолепной системой колец.",
            type: "Газовый гигант",
            radius: 2.4,
            distance: 44,
            speed: 0.003,
            color: 0xf4d03f,
            hasRings: true,
            textureType: "gas"
        },
        "Uranus": {
            name: "Уран",
            desc: "Ледяной гигант бирюзового цвета.",
            type: "Ледяной гигант",
            radius: 1.6,
            distance: 54,
            speed: 0.002,
            color: 0x40e0d0,
            textureType: "gas_smooth"
        },
        "Neptune": {
            name: "Нептун",
            desc: "Ледяной гигант глубокого синего цвета.",
            type: "Ледяной гигант",
            radius: 1.6,
            distance: 64,
            speed: 0.001,
            color: 0x3333ff,
            textureType: "gas_smooth"
        }
    };

    // --- СЦЕНА ---
    const container = document.getElementById('canvas-container');
    const scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x000000, 0.002);

    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 2000);
    camera.position.set(0, 40, 80);

    const renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.0;
    renderer.shadowMap.enabled = true; // Тени для колец
    container.appendChild(renderer.domElement);

    // --- ОСВЕЩЕНИЕ ---
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);

    const sunLight = new THREE.PointLight(0xffffff, 5, 400);
    sunLight.position.set(0, 0, 0);
    sunLight.castShadow = true;
    scene.add(sunLight);

    // --- УПРАВЛЕНИЕ ---
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.maxDistance = 200;
    controls.minDistance = 10;

    // --- ЗВЕЗДНОЕ НЕБО ---
    function createStars() {
        const geometry = new THREE.BufferGeometry();
        const vertices = [];
        for (let i = 0; i < 5000; i++) {
            vertices.push(
                    THREE.MathUtils.randFloatSpread(500),
                    THREE.MathUtils.randFloatSpread(500),
                    THREE.MathUtils.randFloatSpread(500)
            );
        }
        geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
        const material = new THREE.PointsMaterial({color: 0xffffff, size: 0.5, transparent: true, opacity: 0.8});
        const stars = new THREE.Points(geometry, material);
        scene.add(stars);
    }

    createStars();

    // --- ГЕНЕРАТОР ТЕКСТУР ПЛАНЕТ ---
    function createPlanetTexture(type, colorHex) {
        const width = 512;
        const height = 256;
        const canvas = document.createElement('canvas');
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext('2d');
        const baseColor = new THREE.Color(colorHex);

        // Фон
        ctx.fillStyle = `#${baseColor.getHexString()}`;
        ctx.fillRect(0, 0, width, height);

        if (type === 'gas') {
            // Полосы для Юпитера/Сатурна
            for (let i = 0; i < 20; i++) {
                const y = Math.random() * height;
                const h = Math.random() * 20 + 5;
                const hsl = {};
                baseColor.getHSL(hsl);
                hsl.l += (Math.random() - 0.5) * 0.2; // Вариация яркости
                hsl.s += (Math.random() - 0.5) * 0.1;
                const bandColor = new THREE.Color().setHSL(hsl.h, hsl.s, hsl.l);

                ctx.fillStyle = `#${bandColor.getHexString()}`;
                ctx.fillRect(0, y, width, h);
            }
            // Размытие для мягкости
            ctx.filter = 'blur(4px)';
            ctx.drawImage(canvas, 0, 0);

        } else if (type === 'terrestrial') {
            // Кратеры и пятна (Меркурий, Марс)
            for (let i = 0; i < 150; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const r = Math.random() * 15 + 2;

                const hsl = {};
                baseColor.getHSL(hsl);
                hsl.l += (Math.random() - 0.5) * 0.3; // Пятна темнее/светлее
                const spotColor = new THREE.Color().setHSL(hsl.h, hsl.s, hsl.l);

                ctx.beginPath();
                ctx.arc(x, y, r, 0, Math.PI * 2);
                ctx.fillStyle = `#${spotColor.getHexString()}`;
                ctx.fill();
            }

        } else if (type === 'earth') {
            // Континенты (Зеленые пятна)
            ctx.fillStyle = '#2d6a4f'; // Темно-зеленый
            for (let i = 0; i < 40; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const r = Math.random() * 40 + 10;
                ctx.beginPath();
                ctx.arc(x, y, r, 0, Math.PI * 2);
                ctx.fill();
            }
            // Облака (Белые полосы/пятна)
            ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
            for (let i = 0; i < 60; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const w = Math.random() * 60 + 20;
                const h = Math.random() * 20 + 5;
                ctx.fillRect(x, y, w, h);
            }

        } else if (type === 'atmosphere') {
            // Венера (облачная дымка)
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            for (let i = 0; i < 50; i++) {
                const y = Math.random() * height;
                const h = Math.random() * 40 + 10;
                ctx.fillRect(0, y, width, h);
            }
            ctx.filter = 'blur(8px)';
            ctx.drawImage(canvas, 0, 0);

        } else if (type === 'sun') {
            // Солнечные пятна/плазма
            for (let i = 0; i < 200; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const r = Math.random() * 10 + 2;
                ctx.beginPath();
                ctx.arc(x, y, r, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255, 200, 50, 0.3)';
                ctx.fill();
            }
        } else if (type === 'gas_smooth') {
            // Уран/Нептун (плавный градиент)
            const grad = ctx.createLinearGradient(0, 0, 0, height);
            const hsl = {};
            baseColor.getHSL(hsl);
            const c1 = new THREE.Color().setHSL(hsl.h, hsl.s, hsl.l + 0.05);
            const c2 = new THREE.Color().setHSL(hsl.h, hsl.s, hsl.l - 0.05);
            grad.addColorStop(0, `#${c1.getHexString()}`);
            grad.addColorStop(1, `#${c2.getHexString()}`);
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, width, height);
        }

        return new THREE.CanvasTexture(canvas);
    }

    function createGlowTexture() {
        const canvas = document.createElement('canvas');
        canvas.width = 64;
        canvas.height = 64;
        const context = canvas.getContext('2d');
        const gradient = context.createRadialGradient(32, 32, 0, 32, 32, 32);
        gradient.addColorStop(0, 'rgba(255, 170, 0, 1)');
        gradient.addColorStop(0.2, 'rgba(255, 170, 0, 0.6)');
        gradient.addColorStop(0.5, 'rgba(255, 170, 0, 0.1)');
        gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
        context.fillStyle = gradient;
        context.fillRect(0, 0, 64, 64);
        return new THREE.CanvasTexture(canvas);
    }

    // --- СОЗДАНИЕ ПЛАНЕТ ---
    const planets = [];
    const orbitGroup = new THREE.Group();
    scene.add(orbitGroup);

    Object.keys(solarSystemData).forEach(key => {
        const data = solarSystemData[key];

        // Генерируем текстуру
        const texture = createPlanetTexture(data.textureType, data.color);

        let material;
        if (key === 'Sun') {
            material = new THREE.MeshBasicMaterial({
                map: texture,
                color: 0xffffff // Используем карту, цвет белый
            });

            // Свечение
            const sunGlowMat = new THREE.SpriteMaterial({
                map: createGlowTexture(),
                color: 0xffaa00,
                transparent: true,
                opacity: 1.0,
                blending: THREE.AdditiveBlending,
                depthWrite: false // ИСПРАВЛЕНИЕ: предотвращаем перекрытие орбит квадратом
            });
            const sunGlow = new THREE.Sprite(sunGlowMat);
            sunGlow.scale.set(data.radius * 8, data.radius * 8, 1);
            scene.add(sunGlow);
        } else {
            material = new THREE.MeshStandardMaterial({
                map: texture,
                roughness: 0.8,
                metalness: 0.1
            });
        }

        const geometry = new THREE.SphereGeometry(data.radius, 32, 32);
        const mesh = new THREE.Mesh(geometry, material);
        mesh.userData = {key: key};
        mesh.name = key;
        mesh.castShadow = true;
        mesh.receiveShadow = true;

        // Орбита
        if (data.distance > 0) {
            const orbitGeo = new THREE.RingGeometry(data.distance - 0.08, data.distance + 0.08, 128);
            const orbitMat = new THREE.MeshBasicMaterial({
                color: 0xffffff,
                transparent: true,
                opacity: 0.15,
                side: THREE.DoubleSide
            });
            const orbitMesh = new THREE.Mesh(orbitGeo, orbitMat);
            orbitMesh.rotation.x = Math.PI / 2;
            orbitGroup.add(orbitMesh);
        }

        // Кольца Сатурна
        if (data.hasRings) {
            const ringGeo = new THREE.RingGeometry(data.radius * 1.4, data.radius * 2.2, 64);
            // Текстура для колец (шум)
            const ringTex = createPlanetTexture('terrestrial', 0xcfb56b);
            const ringMat = new THREE.MeshStandardMaterial({
                map: ringTex,
                color: 0xffffff,
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.8
            });
            const ring = new THREE.Mesh(ringGeo, ringMat);
            ring.rotation.x = Math.PI / 2;
            ring.receiveShadow = true;
            mesh.add(ring);
        }

        orbitGroup.add(mesh);

        planets.push({
            mesh: mesh,
            distance: data.distance,
            speed: data.speed,
            angle: Math.random() * Math.PI * 2
        });
    });


    // --- ИНТЕРАКТИВНОСТЬ ---
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();

    const panel = document.getElementById('info-panel');
    const titleEl = document.getElementById('info-title');
    const descEl = document.getElementById('info-desc');
    const statsEl = document.getElementById('info-stats');
    const labelEl = document.getElementById('planet-label');

    let highlightedPlanet = null;

    function updateRaycaster(event) {
        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        raycaster.setFromCamera(mouse, camera);
    }

    function onMouseMove(event) {
        updateRaycaster(event);
        const intersects = raycaster.intersectObjects(orbitGroup.children);

        let found = null;
        for (let hit of intersects) {
            if (hit.object.userData.key) {
                found = hit.object;
                break;
            }
        }

        if (found) {
            const key = found.userData.key;
            const data = solarSystemData[key];

            labelEl.textContent = data.name;
            labelEl.style.opacity = 1;

            const vector = found.position.clone();
            vector.project(camera);
            const x = (vector.x * .5 + .5) * window.innerWidth;
            const y = (-(vector.y * .5) + .5) * window.innerHeight;
            labelEl.style.left = `${x}px`;
            labelEl.style.top = `${y}px`;

            document.body.style.cursor = 'pointer';
        } else {
            labelEl.style.opacity = 0;
            document.body.style.cursor = 'default';
        }
    }

    function onClick(event) {
        if (event.target.closest('#info-panel') || event.target.closest('.close-btn')) return;

        updateRaycaster(event);
        const intersects = raycaster.intersectObjects(orbitGroup.children);

        let found = null;
        for (let hit of intersects) {
            if (hit.object.userData.key) {
                found = hit.object;
                break;
            }
        }

        if (found) {
            showInfo(found.userData.key);

            if (highlightedPlanet && highlightedPlanet !== found && highlightedPlanet.material.emissive) {
                highlightedPlanet.material.emissive.setHex(0x000000);
            }
            if (found.material.emissive) {
                highlightedPlanet = found;
                if (found.userData.key !== 'Sun') {
                    found.material.emissive.setHex(0x333333);
                }
            }
        } else {
            closePanel();
        }
    }

    function showInfo(key) {
        const data = solarSystemData[key];
        titleEl.textContent = data.name;
        descEl.textContent = data.desc;

        statsEl.innerHTML = `
                <div class="info-stat">Тип объекта <span>${data.type}</span></div>
                <div class="info-stat">Радиус (усл.) <span>${data.radius}</span></div>
                <div class="info-stat">Расстояние (усл.) <span>${data.distance}</span></div>
            `;

        const hexColor = '#' + data.color.toString(16).padStart(6, '0');
        panel.style.borderLeftColor = hexColor;

        panel.classList.add('active');
    }

    window.closePanel = function () {
        panel.classList.remove('active');
        if (highlightedPlanet && highlightedPlanet.userData.key !== 'Sun') {
            highlightedPlanet.material.emissive.setHex(0x000000);
        }
        highlightedPlanet = null;
    };

    window.addEventListener('mousemove', onMouseMove);
    window.addEventListener('click', onClick);

    // --- АНИМАЦИЯ ---
    function animate() {
        requestAnimationFrame(animate);
        controls.update();

        const timeScale = 0.5;

        planets.forEach(p => {
            if (p.distance > 0) {
                p.angle += p.speed * timeScale;
                p.mesh.position.x = Math.cos(p.angle) * p.distance;
                p.mesh.position.z = Math.sin(p.angle) * p.distance;
            }
            p.mesh.rotation.y += 0.005;
        });

        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    animate();
</script>
</body>
</html>