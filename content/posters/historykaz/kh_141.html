<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ –ú–æ–≥—É–ª–∏—Å—Ç–∞–Ω (XIV‚ÄìXVI –≤–≤.)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Inter:wght@300;400;600&display=swap&subset=cyrillic,cyrillic-ext" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0fdf4; color: #064e3b; }
        h1, h2, h3 { font-family: 'Montserrat', sans-serif; }

        .jade-gradient {
            background: linear-gradient(135deg, #dcfce7 0%, #f0fdf4 50%, #ffffff 100%);
        }

        .premium-card {
            background: white;
            border-radius: 3rem;
            border: 1px solid #bbf7d0;
            transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .premium-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 30px 60px -15px rgba(21, 128, 61, 0.15);
            border-color: #4ade80;
        }

        .lang-active {
            background-color: #065f46;
            color: #ffffff;
            box-shadow: 0 10px 15px -3px rgba(6, 95, 70, 0.3);
        }

        canvas {
            cursor: pointer;
            border-radius: 2.5rem;
            background: #fff;
            border: 1px solid #dcfce7;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.9);
            border-left: 8px solid #10b981;
            padding: 2.5rem;
            border-radius: 2.5rem;
            transition: all 0.5s ease;
        }

        .term-badge {
            background: #dcfce7;
            color: #065f46;
            padding: 4px 14px;
            border-radius: 99px;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
        }
    </style>
</head>
<body class="jade-gradient min-h-screen pb-20">

<!-- Header (Strict text, no emoji) -->
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-xl border-b border-emerald-100 px-6 py-5">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6">
            <h1 id="main-title" class="text-xl md:text-2xl font-black uppercase tracking-[0.3em] text-emerald-900">–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ –ú–æ–≥—É–ª–∏—Å—Ç–∞–Ω (XIV ‚Äì –Ω–∞—á–∞–ª–æ XVI –≤–≤.)</h1>
            <div class="flex bg-emerald-50 p-1 rounded-2xl border border-emerald-200">
                <button onclick="setLang('ru')" id="btn-ru" class="px-6 py-2 rounded-xl text-sm font-bold transition-all">RU</button>
                <button onclick="setLang('kz')" id="btn-kz" class="px-6 py-2 rounded-xl text-sm font-bold transition-all">KZ</button>
                <button onclick="setLang('en')" id="btn-en" class="px-6 py-2 rounded-xl text-sm font-bold transition-all">EN</button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-12 space-y-16">
        
        <!-- Section 1: Interactive Geopolitical Map (Canvas) -->
        <div class="premium-card p-8 md:p-12 shadow-sm">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 items-center">
                <div class="lg:col-span-5 space-y-8">
                    <div id="badge" class="inline-block bg-emerald-700 text-white px-5 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest">Territorial Domain Analysis</div>
                    <h2 id="viz-title" class="text-3xl md:text-4xl font-black text-emerald-950 leading-tight italic uppercase">–ö–∞—Ä—Ç–∞ –î–æ–º–µ–Ω–æ–≤</h2>
                    <p id="viz-desc" class="text-lg text-emerald-900/60 font-light leading-relaxed">
                        –ú–æ–≥—É–ª–∏—Å—Ç–∞–Ω –æ–±—ä–µ–¥–∏–Ω—è–ª –ñ–µ—Ç—ã—Å—É –∏ –ö–∞—à–≥–∞—Ä–∏—é. –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ –¥–µ–ª–∏–ª–æ—Å—å –Ω–∞ –∫–æ—á–µ–≤—ã–µ –∏ –æ—Å–µ–¥–ª—ã–µ –∑–æ–Ω—ã –ø–æ–¥ –≤–ª–∞—Å—Ç—å—é —Ö–∞–Ω–æ–≤-—á–∞–≥–∞—Ç–∞–∏–¥–æ–≤. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ä–µ–≥–∏–æ–Ω—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.
                    </p>
                    
                    <div id="info-display" class="info-panel shadow-xl">
                        <h3 id="element-title" class="text-xl font-bold text-emerald-900 mb-3 uppercase tracking-tighter">–ò—Å—Å–ª–µ–¥—É–π—Ç–µ —Ä–µ–≥–∏–æ–Ω—ã</h3>
                        <p id="element-desc" class="text-emerald-800/70 text-sm leading-relaxed italic">–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ñ–µ—Ç—ã—Å—É, –ö–∞—à–≥–∞—Ä–∏—é –∏–ª–∏ —Å—Ç–æ–ª–∏—Ü—É –ê–ª–º–∞–ª—ã–∫ –Ω–∞ —Å—Ö–µ–º–µ.</p>
                    </div>
                </div>
                
                <div class="lg:col-span-7 p-4 flex items-center justify-center relative min-h-[500px]">
                    <canvas id="mapCanvas"></canvas>
                    <div class="absolute bottom-8 right-12 text-[10px] text-emerald-300 font-mono uppercase tracking-[0.4em]">Schematic Geopolitics of Moghulistan</div>
                </div>
            </div>
        </div>

        <!-- Section 2: Detailed History Content -->
        <div id="plan-section" class="space-y-12">
            <h2 id="plan-title" class="text-center text-3xl font-black text-emerald-900 uppercase tracking-[0.5em]">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –†–µ–ª–∏–≥–∏—è</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                
                <!-- Foundation -->
                <div class="premium-card p-10 flex flex-col border-t-8 border-emerald-600">
                    <div class="mb-6"><span class="term-badge" id="t-dyn">–î–∏–Ω–∞—Å—Ç–∏—è</span></div>
                    <h3 id="c1-t" class="text-xl font-bold mb-4 uppercase text-emerald-900">–¢–æ–≥–ª—É–∫-–¢–∏–º—É—Ä —Ö–∞–Ω</h3>
                    <p id="c1-d" class="text-emerald-800/70 text-sm leading-relaxed mb-6">
                        –û—Å–Ω–æ–≤–∞—Ç–µ–ª—å –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞ (1347 –≥.). –û–Ω —Å—Ç–∞–ª –ø–µ—Ä–≤—ã–º –ø—Ä–∞–≤–∏—Ç–µ–ª–µ–º, —Å—É–º–µ–≤—à–∏–º –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã–µ –ø–ª–µ–º–µ–Ω–∞ –ß–∞–≥–∞—Ç–∞–π—Å–∫–æ–≥–æ —É–ª—É—Å–∞. –¢–æ–≥–ª—É–∫-–¢–∏–º—É—Ä –ø—Ä–æ–≤–µ–ª –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É—é —Ä–µ—Ñ–æ—Ä–º—É, —É–∫—Ä–µ–ø–∏–≤ —Ö–∞–Ω—Å–∫—É—é –≤–ª–∞—Å—Ç—å –∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤ –≤–ª–∏—è–Ω–∏–µ –∑–Ω–∞—Ç–∏.
                    </p>
                    <div class="mt-auto text-[10px] font-black text-emerald-400 uppercase tracking-widest italic" id="c1-f">
                        1347 –≥.: –û—Å–Ω–æ–≤–∞–Ω–∏–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞.
                    </div>
                </div>

                <!-- Islamization -->
                <div class="premium-card p-10 flex flex-col border-t-8 border-emerald-400">
                    <div class="mb-6"><span class="term-badge" id="t-rel">–î—É—Ö–æ–≤–Ω–æ—Å—Ç—å</span></div>
                    <h3 id="c2-t" class="text-xl font-bold mb-4 uppercase text-emerald-900">1354: –ü—Ä–∏–Ω—è—Ç–∏–µ –ò—Å–ª–∞–º–∞</h3>
                    <p id="c2-d" class="text-emerald-800/70 text-sm leading-relaxed mb-6">
                        –ü—Ä–∏ –¢–æ–≥–ª—É–∫-–¢–∏–º—É—Ä–µ –∏—Å–ª–∞–º –±—ã–ª –æ–±—ä—è–≤–ª–µ–Ω –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–ª–∏–≥–∏–µ–π. –ü–æ –ª–µ–≥–µ–Ω–¥–µ, –≤ –æ–¥–∏–Ω –¥–µ–Ω—å –∏—Å–ª–∞–º –ø—Ä–∏–Ω—è–ª–∏ 160 —Ç—ã—Å—è—á —á–µ–ª–æ–≤–µ–∫. –≠—Ç–æ —É–∫—Ä–µ–ø–∏–ª–æ —Å–≤—è–∑–∏ —Å –º—É—Å—É–ª—å–º–∞–Ω—Å–∫–∏–º –º–∏—Ä–æ–º –∏ —É—Å–∫–æ—Ä–∏–ª–æ –ø—Ä–æ—Ü–µ—Å—Å –æ—Å–µ–¥–∞–Ω–∏—è –∫–æ—á–µ–≤–Ω–∏–∫–æ–≤.
                    </p>
                    <div class="mt-auto text-[10px] font-black text-emerald-400 uppercase tracking-widest italic" id="c2-f">
                        –ú–∞–≤–∑–æ–ª–µ–π –¢–æ–≥–ª—É–∫-–¢–∏–º—É—Ä–∞ –≤ –ê–ª–º–∞–ª—ã–∫–µ.
                    </div>
                </div>

                <!-- Social Structure -->
                <div class="premium-card p-10 flex flex-col border-t-8 border-emerald-600">
                    <div class="mb-6"><span class="term-badge" id="t-soc">–û–±—â–µ—Å—Ç–≤–æ</span></div>
                    <h3 id="c3-t" class="text-xl font-bold mb-4 uppercase text-emerald-900">–ü–ª–µ–º—è –î—É–≥–ª–∞—Ç</h3>
                    <p id="c3-d" class="text-emerald-800/70 text-sm leading-relaxed mb-6">
                        –ö–ª—é—á–µ–≤—É—é —Ä–æ–ª—å –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∏–≥—Ä–∞–ª–∞ –∑–Ω–∞—Ç—å –ø–ª–µ–º–µ–Ω–∏ **–î—É–≥–ª–∞—Ç**. –û–Ω–∏ –∑–∞–Ω–∏–º–∞–ª–∏ –ø–æ—Å—Ç **—É–ª—É—Å–±–µ–∫–∞** ‚Äî –≥–ª–∞–≤–Ω–æ–≥–æ —Å–æ–≤–µ—Ç–Ω–∏–∫–∞ –∏ –≤–æ–µ–Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ —Ö–∞–Ω–∞. –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ –∏–º–µ–ª–æ —á–µ—Ç–∫–æ–µ –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ 12 –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –æ–∫—Ä—É–≥–æ–≤, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–ª–æ —Å–±–æ—Ä –≤–æ–π—Å–∫.
                    </p>
                    <div class="mt-auto text-[10px] font-black text-emerald-400 uppercase tracking-widest italic" id="c3-f">
                        –£–ª—É—Å–±–µ–∫ ‚Äî –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–∏—Ç—É–ª.
                    </div>
                </div>

            </div>
        </div>

        <!-- Section 3: The Capital & Silk Road (Full Width) -->
        <div class="bg-emerald-900 p-10 md:p-20 rounded-[4rem] text-white shadow-2xl relative overflow-hidden">
            <div class="relative z-10 grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
                <div>
                    <h3 id="almalyk-t" class="text-4xl font-black mb-8 uppercase italic tracking-tighter">–ê–ª–º–∞–ª—ã–∫: –°–∞–¥ –í–æ—Å—Ç–æ–∫–∞</h3>
                    <p id="almalyk-d" class="text-emerald-100/70 text-xl font-light leading-relaxed mb-10">
                        –°—Ç–æ–ª–∏—Ü–∞ **–ê–ª–º–∞–ª—ã–∫** –±—ã–ª–∞ –∫—Ä—É–ø–Ω–µ–π—à–∏–º —Ç–æ—Ä–≥–æ–≤—ã–º —É–∑–ª–æ–º –Ω–∞ –®–µ–ª–∫–æ–≤–æ–º –ø—É—Ç–∏. –ì–æ—Ä–æ–¥ —Å–ª–∞–≤–∏–ª—Å—è —Å–≤–æ–∏–º–∏ —Å–∞–¥–∞–º–∏, –º–∞—Å—Ç–µ—Ä—Å–∫–∏–º–∏ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤—É —Ç–∫–∞–Ω–µ–π –∏ —á–µ–∫–∞–Ω–∫–æ–π –º–æ–Ω–µ—Ç—ã. –û–Ω –±—ã–ª –∫—É–ª—å—Ç—É—Ä–Ω—ã–º –º–æ—Å—Ç–æ–º –º–µ–∂–¥—É –∫–æ—á–µ–≤–Ω–∏–∫–∞–º–∏ –ñ–µ—Ç—ã—Å—É –∏ –∫—É–ø—Ü–∞–º–∏ –ö–∞—à–≥–∞—Ä–∏–∏.
                    </p>
                    <div class="inline-flex items-center gap-4 bg-white/10 px-6 py-2 rounded-full border border-white/20">
                        <span id="almalyk-tag" class="text-sm font-bold uppercase tracking-widest">–¶–µ–Ω—Ç—Ä –ß–∞–≥–∞—Ç–∞–π—Å–∫–æ–≥–æ –Ω–∞—Å–ª–µ–¥–∏—è</span>
                    </div>
                </div>
                <div class="flex justify-center relative">
                    <div class="w-80 h-80 border-4 border-dashed border-emerald-700/50 rounded-full flex items-center justify-center animate-spin-slow">
                        <div class="text-center">
                            <div class="text-6xl mb-4 grayscale opacity-30">üèîÔ∏è</div>
                            <div class="text-[10px] font-black uppercase text-emerald-300 tracking-[0.5em]">Jade Empire</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="absolute -bottom-20 -right-20 text-[25rem] opacity-5 font-black rotate-45 pointer-events-none uppercase">MOGUL</div>
        </div>

    </main>

    <footer class="mt-20 py-20 bg-emerald-950 text-center border-t border-emerald-900/30">
        <div class="max-w-4xl mx-auto px-6">
            <p id="footer-text" class="text-2xl font-light italic leading-tight text-emerald-200/60">
                ¬´–ú–æ–≥—É–ª–∏—Å—Ç–∞–Ω —Å—Ç–∞–ª —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–º —á–∞–≥–∞—Ç–∞–π—Å–∫–æ–π —Å–ª–∞–≤—ã, –æ–±—ä–µ–¥–∏–Ω–∏–≤ —Å—É—Ä–æ–≤—É—é –≤–æ–ª—é –¢—è–Ω—å-–®–∞–Ω—è —Å –∏–∑—è—â–µ—Å—Ç–≤–æ–º –∏—Å–ª–∞–º—Å–∫–∏—Ö –æ–∞–∑–∏—Å–æ–≤.¬ª
            </p>
            <div class="mt-10 h-1 w-24 bg-emerald-500 mx-auto rounded-full"></div>
        </div>
    </footer>

    <script>
        const translations = {
            ru: {
                title: "–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ –ú–æ–≥—É–ª–∏—Å—Ç–∞–Ω (XIV‚ÄìXVI –≤–≤.)",
                vizTitle: "–ö–∞—Ä—Ç–∞ –î–æ–º–µ–Ω–æ–≤",
                vizDesc: "–ú–æ–≥—É–ª–∏—Å—Ç–∞–Ω –æ–±—ä–µ–¥–∏–Ω—è–ª –ñ–µ—Ç—ã—Å—É –∏ –ö–∞—à–≥–∞—Ä–∏—é. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–æ–Ω—ã –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Å—Ö–µ–º–µ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–≥–∏–æ–Ω–æ–≤.",
                badge: "–ê–Ω–∞–ª–∏–∑ –≥–µ–æ–ø–æ–ª–∏—Ç–∏–∫–∏",
                elementTitleDefault: "–ò—Å—Å–ª–µ–¥—É–π—Ç–µ —Ä–µ–≥–∏–æ–Ω—ã",
                elementDescDefault: "–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ñ–µ—Ç—ã—Å—É, –ö–∞—à–≥–∞—Ä–∏—é –∏–ª–∏ –ê–ª–º–∞–ª—ã–∫ –Ω–∞ —á–µ—Ä—Ç–µ–∂–µ.",
                planTitle: "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –†–µ–ª–∏–≥–∏—è",
                tDyn: "–î–∏–Ω–∞—Å—Ç–∏—è", tRel: "–î—É—Ö–æ–≤–Ω–æ—Å—Ç—å", tSoc: "–û–±—â–µ—Å—Ç–≤–æ",
                c1T: "–¢–æ–≥–ª—É–∫-–¢–∏–º—É—Ä —Ö–∞–Ω", c1D: "–ü–µ—Ä–≤—ã–π —Ö–∞–Ω –ú–æ–≥—É–ª–∏—Å—Ç–∞–Ω–∞. –û–Ω —Å—É–º–µ–ª —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–ª–∞—Å—Ç—å –ø–æ—Å–ª–µ —Ä–∞—Å–ø–∞–¥–∞ –ß–∞–≥–∞—Ç–∞–π—Å–∫–æ–≥–æ —É–ª—É—Å–∞ –∏ –∑–∞–ª–æ–∂–∏—Ç—å –æ—Å–Ω–æ–≤—ã –Ω–æ–≤–æ–π –∏–º–ø–µ—Ä—Å–∫–æ–π –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏.",
                c1F: "1347 –≥.: –û—Å–Ω–æ–≤–∞–Ω–∏–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞.",
                c2T: "–ü—Ä–∏–Ω—è—Ç–∏–µ –ò—Å–ª–∞–º–∞", c2D: "–í 1354 –≥–æ–¥—É –∏—Å–ª–∞–º —Å—Ç–∞–ª –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–ª–∏–≥–∏–µ–π. –≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±—Å—Ç–≤–æ–≤–∞–ª–æ –∫—É–ª—å—Ç—É—Ä–Ω–æ–º—É —Ä–∞—Å—Ü–≤–µ—Ç—É –∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—é –º–Ω–æ–≥–æ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –ø–ª–µ–º–µ–Ω.",
                c2F: "–ú–∞–≤–∑–æ–ª–µ–π –¢–æ–≥–ª—É–∫-–¢–∏–º—É—Ä–∞ ‚Äî –ø–∞–º—è—Ç–Ω–∏–∫ —ç–ø–æ—Ö–∏.",
                c3T: "–ü–ª–µ–º—è –î—É–≥–ª–∞—Ç", c3D: "–ê—Ä–∏—Å—Ç–æ–∫—Ä–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–µ—Ä—Ö—É—à–∫–∞. –î—É–≥–ª–∞—Ç—ã –≤–ª–∞–¥–µ–ª–∏ —Ç–∏—Ç—É–ª–æ–º —É–ª—É—Å–±–µ–∫–æ–≤ –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –¥–µ–ª–∞–º–∏ –∏ –∞—Ä–º–∏–µ–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞.",
                c3F: "–£–ª—É—Å–±–µ–∫ ‚Äî —Ö—Ä–∞–Ω–∏—Ç–µ–ª—å —Ç—Ä–∞–¥–∏—Ü–∏–π.",
                almalykT: "–ê–ª–º–∞–ª—ã–∫: –°–∞–¥ –í–æ—Å—Ç–æ–∫–∞", almalykD: "–°—Ç–æ–ª–∏—Ü–∞ –∏ –±–æ–≥–∞—Ç–µ–π—à–∏–π –≥–æ—Ä–æ–¥. –ê–ª–º–∞–ª—ã–∫ –±—ã–ª —Ä—ã–Ω–∫–æ–º, –≥–¥–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –ö–∏—Ç–∞—è –æ–±–º–µ–Ω–∏–≤–∞–ª–∏—Å—å –Ω–∞ –ø—Ä–æ–¥—É–∫—Ü–∏—é –∫–æ—á–µ–≤–Ω–∏–∫–æ–≤ –°–µ–º–∏—Ä–µ—á—å—è.",
                almalykTag: "–¶–µ–Ω—Ç—Ä –ß–∞–≥–∞—Ç–∞–π—Å–∫–æ–≥–æ –Ω–∞—Å–ª–µ–¥–∏—è",
                footer: "¬´–ú–æ–≥—É–ª–∏—Å—Ç–∞–Ω —Å—Ç–∞–ª —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–º —á–∞–≥–∞—Ç–∞–π—Å–∫–æ–π —Å–ª–∞–≤—ã, –æ–±—ä–µ–¥–∏–Ω–∏–≤ –≤–æ–ª—é –¢—è–Ω—å-–®–∞–Ω—è —Å –∏–∑—è—â–µ—Å—Ç–≤–æ–º –æ–∞–∑–∏—Å–æ–≤.¬ª",
                regions: {
                    zhetysu: { name: "–ñ–µ—Ç—ã—Å—É (–°–µ–º–∏—Ä–µ—á—å–µ)", text: "–°–µ–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞. –¶–µ–Ω—Ç—Ä –∫–æ—á–µ–≤–æ–≥–æ —Å–∫–æ—Ç–æ–≤–æ–¥—Å—Ç–≤–∞ –∏ —Ä–æ–¥–∏–Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–ª–µ–º–µ–Ω –ú–æ–≥—É–ª–∏—Å—Ç–∞–Ω–∞." },
                    kashgar: { name: "–ö–∞—à–≥–∞—Ä–∏—è", text: "–Æ–∂–Ω–∞—è —á–∞—Å—Ç—å –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞. –ö—Ä–∞–π –¥—Ä–µ–≤–Ω–∏—Ö –æ—Å–µ–¥–ª—ã—Ö –æ–∞–∑–∏—Å–æ–≤, —Ü–µ–Ω—Ç—Ä–æ–≤ –Ω–∞—É–∫–∏, —Ä–µ–º–µ—Å–ª–∞ –∏ –º—É—Å—É–ª—å–º–∞–Ω—Å–∫–æ–π –∫—É–ª—å—Ç—É—Ä—ã." },
                    almalyk: { name: "–°—Ç–æ–ª–∏—Ü–∞ –ê–ª–º–∞–ª—ã–∫", text: "–ì–ª–∞–≤–Ω—ã–π –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∏ —Ç–æ—Ä–≥–æ–≤—ã–π —Ö–∞–±. –ó–¥–µ—Å—å –Ω–∞—Ö–æ–¥–∏–ª–∞—Å—å —Å—Ç–∞–≤–∫–∞ —Ö–∞–Ω–æ–≤ –∏ —á–µ–∫–∞–Ω–∏–ª–∞—Å—å –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è –º–æ–Ω–µ—Ç–∞." }
                }
            },
            kz: {
                title: "–ú–æ“ì–æ–ª—Å—Ç–∞–Ω –º–µ–º–ª–µ–∫–µ—Ç—ñ (–•–ÜV‚Äì–•V–Ü “ì“ì.)",
                vizTitle: "–î–æ–º–µ–Ω–¥–µ—Ä –ö–∞—Ä—Ç–∞—Å—ã",
                vizDesc: "–ú–æ“ì–æ–ª—Å—Ç–∞–Ω –ñ–µ—Ç—ñ—Å—É –º–µ–Ω “ö–∞—à“õ–∞—Ä–∏—è–Ω—ã –±—ñ—Ä—ñ–∫—Ç—ñ—Ä–¥—ñ. –ê–π–º–∞“õ—Ç–∞—Ä–¥—ã —Ç–∞–ª–¥–∞—É “Ø—à—ñ–Ω —Å—ã–∑–±–∞–¥–∞“ì—ã –Ω–µ–≥—ñ–∑–≥—ñ —ã“õ–ø–∞–ª –µ—Ç—É –∞–π–º–∞“õ—Ç–∞—Ä—ã–Ω –±–∞—Å—ã“£—ã–∑.",
                badge: "–ì–µ–æ—Å–∞—è—Å–∞—Ç—Ç—ã —Ç–∞–ª–¥–∞—É",
                elementTitleDefault: "–ê–π–º–∞“õ—Ç–∞—Ä–¥—ã –∑–µ—Ä—Ç—Ç–µ“£—ñ–∑",
                elementDescDefault: "–°—ã–∑–±–∞–¥–∞“ì—ã –ñ–µ—Ç—ñ—Å—É, “ö–∞—à“õ–∞—Ä–∏—è –Ω–µ–º–µ—Å–µ –ê–ª–º–∞–ª—ã“õ—Ç—ã –±–∞—Å—ã“£—ã–∑.",
                planTitle: "“ö“±—Ä—ã–ª—ã–º –º–µ–Ω –î—ñ–Ω",
                tDyn: "”ò—É–ª–µ—Ç", tRel: "–†—É—Ö–∞–Ω–∏—è—Ç", tSoc: "”ò–ª–µ—É–º–µ—Ç",
                c1T: "–¢–æ“ì—ã–ª—ã“õ –¢–µ–º—ñ—Ä —Ö–∞–Ω", c1D: "–ú–æ“ì–æ–ª—Å—Ç–∞–Ω–Ω—ã“£ –∞–ª“ì–∞—à“õ—ã —Ö–∞–Ω—ã. –û–ª –®–∞“ì–∞—Ç–∞–π “±–ª—ã—Å—ã —ã–¥—ã—Ä–∞“ì–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω –±–∏–ª—ñ–∫—Ç—ñ –æ—Ä—Ç–∞–ª—ã“õ—Ç–∞–Ω–¥—ã—Ä—ã–ø, –∂–∞“£–∞ –∏–º–ø–µ—Ä–∏—è–ª—ã“õ –±—ñ—Ä–µ–≥–µ–π–ª—ñ–∫—Ç—ñ“£ –Ω–µ–≥—ñ–∑—ñ–Ω “õ–∞–ª–∞–¥—ã.",
                c1F: "1347 –∂.: –ú–µ–º–ª–µ–∫–µ—Ç—Ç—ñ“£ “õ“±—Ä—ã–ª—É—ã.",
                c2T: "–ò—Å–ª–∞–º–¥—ã “õ–∞–±—ã–ª–¥–∞—É", c2D: "1354 –∂—ã–ª—ã –∏—Å–ª–∞–º –º–µ–º–ª–µ–∫–µ—Ç—Ç—ñ–∫ –¥—ñ–Ω –±–æ–ª—ã–ø –∂–∞—Ä–∏—è–ª–∞–Ω–¥—ã. –ë“±–ª —à–µ—à—ñ–º –º”ô–¥–µ–Ω–∏–µ—Ç—Ç—ñ“£ ”©—Ä–∫–µ–Ω–¥–µ—É—ñ–Ω–µ –∂”ô–Ω–µ –∫”©–ø—Ç–µ–≥–µ–Ω —Ç–∞–π–ø–∞–ª–∞—Ä–¥—ã“£ –±—ñ—Ä—ñ–≥—É—ñ–Ω–µ —ã“õ–ø–∞–ª –µ—Ç—Ç—ñ.",
                c2F: "–¢–æ“ì—ã–ª—ã“õ –¢–µ–º—ñ—Ä –∫–µ—Å–µ–Ω–µ—Å—ñ ‚Äî –¥”ô—É—ñ—Ä –µ—Å–∫–µ—Ä—Ç–∫—ñ—à—ñ.",
                c3T: "–î—É–ª–∞—Ç —Ç–∞–π–ø–∞—Å—ã", c3D: "–ê“õ—Å“Ø–π–µ–∫—Ç–µ—Ä —Ç–æ–±—ã. –î—É–ª–∞—Ç—Ç–∞—Ä —É–ª—É—Å–±–µ–∫ –ª–∞—É–∞–∑—ã–º—ã–Ω–∞ –∏–µ –±–æ–ª—ã–ø, –º–µ–º–ª–µ–∫–µ—Ç—Ç—ñ“£ —ñ—à–∫—ñ —ñ—Å—Ç–µ—Ä—ñ –º–µ–Ω ”ô—Å–∫–µ—Ä—ñ–Ω –±–∞—Å“õ–∞—Ä–¥—ã.",
                c3F: "“∞–ª—ã—Å–±–µ–∫ ‚Äî –¥”ô—Å—Ç“Ø—Ä —Å–∞“õ—Ç–∞—É—à—ã.",
                almalykT: "–ê–ª–º–∞–ª—ã“õ: –®—ã“ì—ã—Å –±–∞“ì—ã", almalykD: "–ê—Å—Ç–∞–Ω–∞ –∂”ô–Ω–µ –µ“£ –±–∞–π “õ–∞–ª–∞. –ê–ª–º–∞–ª—ã“õ “ö—ã—Ç–∞–π —Ç–∞—É–∞—Ä–ª–∞—Ä—ã –ñ–µ—Ç—ñ—Å—É –∫”©—à–ø–µ–ª—ñ–ª–µ—Ä—ñ–Ω—ñ“£ ”©–Ω—ñ–º–¥–µ—Ä—ñ–Ω–µ –∞–ª–º–∞—Å–∞—Ç—ã–Ω –Ω–∞—Ä—ã“õ –±–æ–ª–¥—ã.",
                almalykTag: "–®–∞“ì–∞—Ç–∞–π –º“±—Ä–∞—Å—ã–Ω—ã“£ –æ—Ä—Ç–∞–ª—ã“ì—ã",
                footer: "¬´–ú–æ“ì–æ–ª—Å—Ç–∞–Ω –¢—è–Ω—å-–®–∞–Ω—å–Ω—ã“£ –µ—Ä—ñ–∫-–∂—ñ–≥–µ—Ä—ñ –º–µ–Ω —à“±—Ä–∞—Ç—Ç–∞—Ä–¥—ã“£ ”ô—Å–µ–º–¥—ñ–≥—ñ–Ω –±—ñ—Ä—ñ–∫—Ç—ñ—Ä—ñ–ø, –®–∞“ì–∞—Ç–∞–π –¥–∞“£“õ—ã–Ω —Å–∞“õ—Ç–∞—É—à—ã –±–æ–ª–¥—ã.¬ª",
                regions: {
                    zhetysu: { name: "–ñ–µ—Ç—ñ—Å—É", text: "–ú–µ–º–ª–µ–∫–µ—Ç—Ç—ñ“£ —Å–æ–ª—Ç“Ø—Å—Ç—ñ–∫ –±”©–ª—ñ–≥—ñ. –ö”©—à–ø–µ–ª—ñ –º–∞–ª —à–∞—Ä—É–∞—à—ã–ª—ã“ì—ã–Ω—ã“£ –æ—Ä—Ç–∞–ª—ã“ì—ã –∂”ô–Ω–µ –ú–æ“ì–æ–ª—Å—Ç–∞–Ω–Ω—ã“£ –Ω–µ–≥—ñ–∑–≥—ñ —Ç–∞–π–ø–∞–ª–∞—Ä—ã–Ω—ã“£ –û—Ç–∞–Ω—ã." },
                    kashgar: { name: "“ö–∞—à“õ–∞—Ä–∏—è", text: "–ú–µ–º–ª–µ–∫–µ—Ç—Ç—ñ“£ –æ“£—Ç“Ø—Å—Ç—ñ–∫ –±”©–ª—ñ–≥—ñ. –ï–∂–µ–ª–≥—ñ –æ—Ç—ã—Ä—ã“õ—à—ã —à“±—Ä–∞—Ç—Ç–∞—Ä, “ì—ã–ª—ã–º, “õ–æ–ª”©–Ω–µ—Ä –∂”ô–Ω–µ –º“±—Å—ã–ª–º–∞–Ω –º”ô–¥–µ–Ω–∏–µ—Ç—ñ–Ω—ñ“£ –æ—Ä—Ç–∞–ª—ã“ì—ã." },
                    almalyk: { name: "–ê–ª–º–∞–ª—ã“õ –∞—Å—Ç–∞–Ω–∞—Å—ã", text: "–ë–∞—Å—Ç—ã —Å–∞—è—Å–∏ –∂”ô–Ω–µ —Å–∞—É–¥–∞ —Ç–æ—Ä–∞–±—ã. –ú“±–Ω–¥–∞ —Ö–∞–Ω–¥–∞—Ä–¥—ã“£ –æ—Ä–¥–∞—Å—ã –æ—Ä–Ω–∞–ª–∞—Å—ã–ø, –º–µ–º–ª–µ–∫–µ—Ç—Ç—ñ–∫ —Ç–µ“£–≥–µ —Å–æ“ì—ã–ª–¥—ã." }
                }
            },
            en: {
                title: "Moghulistan State (14th‚Äì16th c.)",
                vizTitle: "Domain Map",
                vizDesc: "Moghulistan united Semirechye and Kashgaria. Click on the primary influence zones on the schematic for region analysis.",
                badge: "Geopolitical Analysis",
                elementTitleDefault: "Explore Regions",
                elementDescDefault: "Click on Zhetysu, Kashgaria, or Almalyk on the diagram.",
                planTitle: "Structure and Religion",
                tDyn: "Dynasty", tRel: "Spirituality", tSoc: "Society",
                c1T: "Togluk-Timur Khan", c1D: "The first Khan of Moghulistan. He centralized power after the collapse of the Chaghatai Ulus, founding a new imperial identity.",
                c1F: "1347 AD: Foundation of the State.",
                c2T: "Adoption of Islam", c2D: "In 1354, Islam was declared the state religion, promoting cultural growth and the unification of various tribes.",
                c2F: "Togluk-Timur Mausoleum ‚Äî monument of the era.",
                c3T: "The Dughlat Tribe", c3D: "The aristocratic elite. The Dughlats held the title of Ulusbeg and effectively managed internal affairs and the army.",
                c3F: "Ulusbeg ‚Äî guardian of tradition.",
                almalykT: "Almalyk: Garden of the East", almalykD: "The capital and wealthiest city. Almalyk was a market where Chinese goods were traded for nomadic products from Zhetysu.",
                almalykTag: "Center of Chaghatai Heritage",
                footer: "¬´Moghulistan preserved the Chaghatai glory, merging the will of the Tian-Shan with the elegance of the oases.¬ª",
                regions: {
                    zhetysu: { name: "Zhetysu (Semirechye)", text: "The northern part of the state. A hub of nomadic pastoralism and the homeland of the main Moghul tribes." },
                    kashgar: { name: "Kashgaria", text: "The southern part of the state. A land of ancient sedentary oases, centers of science, crafts, and Muslim culture." },
                    almalyk: { name: "Capital Almalyk", text: "The primary political and trade hub. It housed the Khan's headquarters and the state mint." }
                }
            }
        };

        let currentLang = 'ru';
        const canvas = document.getElementById('mapCanvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = 500;
            drawMap();
        }

        function drawMap() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            const scale = canvas.width / 800;

            // 1. Zhetysu (Northern Domain - Greenish)
            ctx.beginPath();
            ctx.moveTo(100 * scale, 200 * scale);
            ctx.lineTo(450 * scale, 50 * scale);
            ctx.lineTo(600 * scale, 200 * scale);
            ctx.lineTo(350 * scale, 300 * scale);
            ctx.closePath();
            ctx.fillStyle = 'rgba(16, 185, 129, 0.1)';
            ctx.fill();
            ctx.strokeStyle = '#059669';
            ctx.lineWidth = 3 * scale;
            ctx.stroke();

            // 2. Kashgaria (Southern Domain - Amberish)
            ctx.beginPath();
            ctx.moveTo(350 * scale, 310 * scale);
            ctx.lineTo(600 * scale, 210 * scale);
            ctx.lineTo(750 * scale, 350 * scale);
            ctx.lineTo(500 * scale, 450 * scale);
            ctx.closePath();
            ctx.fillStyle = 'rgba(245, 158, 11, 0.1)';
            ctx.fill();
            ctx.strokeStyle = '#d97706';
            ctx.stroke();

            // 3. Capital Node (Almalyk)
            drawNode(480 * scale, 250 * scale, '#065f46', "ALMALYK", 18 * scale);

            // Labels
            ctx.fillStyle = '#064e3b';
            ctx.font = 'bold 12px Montserrat';
            ctx.fillText("ZHETYSU", 200 * scale, 150 * scale);
            ctx.fillText("KASHGARIA", 550 * scale, 350 * scale);

            // Instructions
            ctx.fillStyle = 'rgba(6, 78, 59, 0.2)';
            ctx.font = 'bold 10px Inter';
            ctx.textAlign = 'center';
            ctx.fillText("TAP ON DOMAINS OR CAPITAL", cx, 40 * scale);
        }

        function drawNode(x, y, color, label, size) {
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            ctx.fillStyle = '#064e3b';
            ctx.font = 'bold 10px Montserrat';
            ctx.textAlign = 'center';
            ctx.fillText(label, x, y + size + 15);
        }

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const scale = canvas.width / 800;

            let target = null;
            // Area check (Simple bbox approach for reliability)
            if (Math.sqrt((x - 480*scale)**2 + (y - 250*scale)**2) < 30) target = 'almalyk';
            else if (y < 280 * scale) target = 'zhetysu';
            else target = 'kashgar';

            if (target) {
                const info = translations[currentLang].regions[target];
                document.getElementById('element-title').innerText = info.name;
                document.getElementById('element-desc').innerText = info.text;
                document.getElementById('info-display').style.borderColor = (target === 'almalyk' ? '#065f46' : (target === 'zhetysu' ? '#10b981' : '#d97706'));
            }
        });

        function setLang(lang) {
            currentLang = lang;
            const t = translations[lang];
            document.getElementById('main-title').innerText = t.title;
            document.getElementById('viz-title').innerText = t.vizTitle;
            document.getElementById('viz-desc').innerText = t.vizDesc;
            document.getElementById('badge').innerText = t.badge;
            document.getElementById('element-title').innerText = t.elementTitleDefault;
            document.getElementById('element-desc').innerText = t.elementDescDefault;
            document.getElementById('plan-title').innerText = t.planTitle;
            
            document.getElementById('t-dyn').innerText = t.tDyn;
            document.getElementById('t-rel').innerText = t.tRel;
            document.getElementById('t-soc').innerText = t.tSoc;

            document.getElementById('c1-t').innerText = t.c1T; document.getElementById('c1-d').innerText = t.c1D;
            document.getElementById('c1-f').innerText = t.c1F;
            document.getElementById('c2-t').innerText = t.c2T; document.getElementById('c2-d').innerText = t.c2D;
            document.getElementById('c2-f').innerText = t.c2F;
            document.getElementById('c3-t').innerText = t.c3T; document.getElementById('c3-d').innerText = t.c3D;
            document.getElementById('c3-f').innerText = t.c3F;

            document.getElementById('almalyk-t').innerText = t.almalykT;
            document.getElementById('almalyk-d').innerText = t.almalykD;
            document.getElementById('almalyk-tag').innerText = t.almalykTag;
            document.getElementById('footer-text').innerText = t.footer;

            ['ru', 'kz', 'en'].forEach(l => {
                const btn = document.getElementById(`btn-${l}`);
                btn.className = l === lang ? "px-6 py-2 rounded-xl text-sm font-black lang-active" : "px-6 py-2 rounded-xl text-sm font-bold text-emerald-600 hover:bg-white transition-all";
            });
            resizeCanvas();
        }

        window.onload = () => { resizeCanvas(); setLang('ru'); };
        window.onresize = resizeCanvas;
    </script>

<script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script>







<style data-oi-map-overlay>
.oi-map-btn{
  position:fixed; right:16px; bottom:16px; z-index:9999;
  padding:10px 14px; border-radius:999px; border:1px solid rgba(0,0,0,.15);
  background:#fff; cursor:pointer; font:600 14px/1.1 system-ui,-apple-system,Segoe UI,Roboto,Arial;
  box-shadow:0 8px 20px rgba(0,0,0,.12);
}
.oi-map-backdrop{
  position:fixed; inset:0; background:rgba(0,0,0,.72); z-index:10000;
  display:none; align-items:center; justify-content:center; padding:18px;
}
.oi-map-backdrop[aria-hidden="false"]{ display:flex; }
.oi-map-modal{
  width:min(1100px, 100%); height:min(85vh, 900px);
  background:#111; border-radius:14px; overflow:hidden; position:relative;
  box-shadow:0 20px 60px rgba(0,0,0,.35);
}
.oi-map-close{
  position:absolute; top:10px; right:10px; z-index:3;
  width:40px; height:40px; border-radius:999px; border:1px solid rgba(255,255,255,.25);
  background:rgba(0,0,0,.35); color:#fff; cursor:pointer; font-size:22px;
}
.oi-map-viewport{
  width:100%; height:100%; overflow:auto; -webkit-overflow-scrolling:touch;
  touch-action: pan-x pan-y;
  background:#000;
  padding-top:56px; /* –º–µ—Å—Ç–æ –ø–æ–¥ —Ç—É–ª–±–∞—Ä */
}
.oi-map-img{
  display:block;
  transform-origin: 0 0;
  user-select:none; -webkit-user-drag:none;
}
.oi-map-toolbar{
  position:absolute; left:12px; top:12px; right:12px; z-index:2;
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  pointer-events:none;
}
.oi-map-tabs{ display:flex; gap:8px; pointer-events:auto; }
.oi-map-tab{
  width:36px; height:34px; border-radius:10px;
  border:1px solid rgba(255,255,255,.22);
  background:rgba(0,0,0,.35); color:#fff;
  cursor:pointer; font:600 14px system-ui,-apple-system,Segoe UI,Roboto,Arial;
}
.oi-map-tab.is-active{
  background:rgba(255,255,255,.12);
  border-color: rgba(255,255,255,.45);
}
.oi-map-hint{
  pointer-events:none;
  color:#fff; opacity:.85; font:12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.18);
  padding:8px 10px; border-radius:10px;
}
</style>

<button class="oi-map-btn" type="button" data-oi-map-btn>üó∫Ô∏è –ö–∞—Ä—Ç–∞</button>

<div class="oi-map-backdrop" aria-hidden="true" data-oi-map-backdrop>
  <div class="oi-map-modal" role="dialog" aria-modal="true" aria-label="–ö–∞—Ä—Ç–∞">
    <button class="oi-map-close" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å" data-oi-map-close>√ó</button>

    <div class="oi-map-toolbar">
      <div class="oi-map-tabs">
        <button type="button" class="oi-map-tab is-active" data-oi-map-tab="1">1</button>
        <button type="button" class="oi-map-tab" data-oi-map-tab="2">2</button>
        <button type="button" class="oi-map-tab" data-oi-map-tab="3">3</button>
        <button type="button" class="oi-map-tab" data-oi-map-tab="4">4</button>
      </div>
      <div class="oi-map-hint">–ö–æ–ª—ë—Å–∏–∫–æ/—Ç—Ä–µ–∫–ø–∞–¥ ‚Äî –∑—É–º ‚Ä¢ Esc ‚Äî –∑–∞–∫—Ä—ã—Ç—å</div>
    </div>

    <div class="oi-map-viewport" data-oi-map-viewport>
      <img class="oi-map-img" data-oi-map-img data-map="1" src="../../assets/maps/karta_1.png" alt="–ö–∞—Ä—Ç–∞ 1" style="display:block;">
<img class="oi-map-img" data-oi-map-img data-map="2" src="../../assets/maps/karta_2.png" alt="–ö–∞—Ä—Ç–∞ 2" style="display:none;">
<img class="oi-map-img" data-oi-map-img data-map="3" src="../../assets/maps/karta_3.png" alt="–ö–∞—Ä—Ç–∞ 3" style="display:none;">
<img class="oi-map-img" data-oi-map-img data-map="4" src="../../assets/maps/karta_4.png" alt="–ö–∞—Ä—Ç–∞ 4" style="display:none;">
    </div>
  </div>
</div>


<script data-oi-map-overlay>
(function(){
  const btn = document.querySelector('[data-oi-map-btn]');
  const backdrop = document.querySelector('[data-oi-map-backdrop]');
  const closeBtn = document.querySelector('[data-oi-map-close]');
  const viewport = document.querySelector('[data-oi-map-viewport]');
  const tabs = Array.from(document.querySelectorAll('[data-oi-map-tab]'));
  const imgs = Array.from(document.querySelectorAll('[data-oi-map-img][data-map]'));
  if(!btn || !backdrop || !closeBtn || !viewport || imgs.length === 0) return;

  let scale = 1;

  function applyScale(){
    imgs.forEach(img => { img.style.transform = `scale(${scale})`; });
  }
  function openMap(){
    backdrop.setAttribute('aria-hidden','false');
    document.body.style.overflow = 'hidden';
  }
  function closeMap(){
    backdrop.setAttribute('aria-hidden','true');
    document.body.style.overflow = '';
  }
  function showMap(n){
    imgs.forEach(img => {
      img.style.display = (img.getAttribute('data-map') === String(n)) ? 'block' : 'none';
    });
    tabs.forEach(t => t.classList.toggle('is-active', t.getAttribute('data-oi-map-tab') === String(n)));
    viewport.scrollTop = 0;
    viewport.scrollLeft = 0;
  }

  btn.addEventListener('click', openMap);
  closeBtn.addEventListener('click', closeMap);
  backdrop.addEventListener('click', (e)=>{ if(e.target === backdrop) closeMap(); });
  window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeMap(); });

  tabs.forEach(t => t.addEventListener('click', () => showMap(t.getAttribute('data-oi-map-tab'))));

  viewport.addEventListener('wheel', (e)=>{
    if(backdrop.getAttribute('aria-hidden') !== 'false') return;
    e.preventDefault();
    const delta = -Math.sign(e.deltaY) * 0.1;
    scale = Math.min(4, Math.max(0.6, scale + delta));
    applyScale();
  }, {passive:false});

  applyScale();
  showMap(1);
})();
</script>
</body>
</html>