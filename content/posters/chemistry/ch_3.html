<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è —Ä–µ—à—ë—Ç–∫–∞ NaCl</title>
    <script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            overflow: hidden;
            color: white;
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }

        .back-button:hover {
            transform: translateX(-5px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .header {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 800;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
        }

        .info-panel {
            position: fixed;
            right: -420px;
            top: 50%;
            transform: translateY(-50%);
            width: 400px;
            max-height: 85vh;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px 0 0 20px;
            padding: 30px;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.4);
            transition: right 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 500;
            overflow-y: auto;
            color: #333;
        }

        .info-panel.active {
            right: 0;
        }

        .info-panel .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #f44336;
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .info-panel .close-btn:hover {
            transform: scale(1.1);
        }

        .info-panel h2 {
            color: #16213e;
            font-size: 24px;
            margin-bottom: 15px;
            padding-right: 40px;
        }

        .info-panel .info-content {
            line-height: 1.7;
            font-size: 15px;
        }

        .info-section {
            margin-bottom: 18px;
            padding: 15px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .info-section strong {
            color: #1a1a2e;
            display: block;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .controls p {
            font-size: 14px;
            opacity: 0.95;
            text-align: center;
        }

        .crystal-info {
            position: fixed;
            top: 120px;
            left: 30px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 300px;
        }

        .crystal-info h3 {
            font-size: 18px;
            margin-bottom: 12px;
            font-weight: 600;
            color: #667eea;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 14px;
        }

        .info-row .label {
            opacity: 0.85;
        }

        .info-row .value {
            font-weight: 600;
        }

        .legend {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 280px;
        }

        .legend h3 {
            font-size: 16px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            font-size: 13px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .legend-item:hover {
            transform: translateX(5px);
        }

        .legend-sphere {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            margin-right: 12px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .view-controls {
            position: fixed;
            top: 120px;
            right: 30px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .view-controls h3 {
            font-size: 16px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .view-btn {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            background: rgba(102, 126, 234, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .view-btn:hover {
            background: rgba(102, 126, 234, 0.5);
            transform: translateY(-2px);
        }

        .view-btn.active {
            background: rgba(102, 126, 234, 0.8);
            border-color: rgba(255, 255, 255, 0.6);
        }
    </style>
</head>
<body>
<button class="back-button" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>

<div class="header">
    <h1>üßÇ –ö—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è —Ä–µ—à—ë—Ç–∫–∞ NaCl</h1>
    <p>–ü–æ–≤–∞—Ä–µ–Ω–Ω–∞—è —Å–æ–ª—å - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è 3D –º–æ–¥–µ–ª—å</p>
</div>

<div id="canvas-container"></div>

<div class="crystal-info">
    <h3>–•–ª–æ—Ä–∏–¥ –Ω–∞—Ç—Ä–∏—è (NaCl)</h3>
    <div class="info-row">
        <span class="label">–¢–∏–ø —Ä–µ—à—ë—Ç–∫–∏:</span>
        <span class="value">–ì–¶–ö</span>
    </div>
    <div class="info-row">
        <span class="label">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü. —á–∏—Å–ª–æ:</span>
        <span class="value">6</span>
    </div>
    <div class="info-row">
        <span class="label">–ü–∞—Ä–∞–º–µ—Ç—Ä —Ä–µ—à—ë—Ç–∫–∏:</span>
        <span class="value">5.64 √Ö</span>
    </div>
    <div class="info-row">
        <span class="label">–¢–∏–ø —Å–≤—è–∑–∏:</span>
        <span class="value">–ò–æ–Ω–Ω–∞—è</span>
    </div>
    <div class="info-row">
        <span class="label">T –ø–ª–∞–≤–ª–µ–Ω–∏—è:</span>
        <span class="value">801¬∞C</span>
    </div>
    <div class="info-row">
        <span class="label">–ü–ª–æ—Ç–Ω–æ—Å—Ç—å:</span>
        <span class="value">2.16 –≥/—Å–º¬≥</span>
    </div>
</div>

<div class="view-controls">
    <h3>–í–∏–¥ —Ä–µ—à—ë—Ç–∫–∏:</h3>
    <button class="view-btn active" onclick="setLatticeSize(3)">3√ó3√ó3</button>
    <button class="view-btn" onclick="setLatticeSize(4)">4√ó4√ó4</button>
    <button class="view-btn" onclick="setLatticeSize(5)">5√ó5√ó5</button>
    <button class="view-btn" onclick="toggleBonds()">–ü–æ–∫–∞–∑–∞—Ç—å —Å–≤—è–∑–∏</button>
</div>

<div class="info-panel" id="info-panel">
    <button class="close-btn" onclick="closeInfo()">√ó</button>
    <h2 id="info-title">–ö—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è —Ä–µ—à—ë—Ç–∫–∞</h2>
    <div class="info-content" id="info-content">
        <p>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∏–æ–Ω –Ω–∞—Ç—Ä–∏—è –∏–ª–∏ —Ö–ª–æ—Ä–∞, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ.</p>
    </div>
</div>

<div class="controls">
    <p>üñ±Ô∏è –í—Ä–∞—â–µ–Ω–∏–µ: –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ | üîç –ú–∞—Å—à—Ç–∞–±: –∫–æ–ª–µ—Å–æ –º—ã—à–∏ | –ü—Ä–æ–±–µ–ª: –ø–∞—É–∑–∞</p>
</div>

<div class="legend">
    <h3>–ò–æ–Ω—ã:</h3>
    <div class="legend-item" onclick="focusPart('sodium')">
        <div class="legend-sphere" style="background: radial-gradient(circle at 30% 30%, #9b59b6, #8e44ad);"></div>
        <span>–ù–∞—Ç—Ä–∏–π Na‚Å∫ (95 –ø–º)</span>
    </div>
    <div class="legend-item" onclick="focusPart('chloride')">
        <div class="legend-sphere" style="background: radial-gradient(circle at 30% 30%, #2ecc71, #27ae60);"></div>
        <span>–•–ª–æ—Ä Cl‚Åª (181 –ø–º)</span>
    </div>
</div>

<script>
    // QWebChannel Bridge
    function goBack() {
        if (typeof bridge !== 'undefined' && bridge) {
            bridge.onBackClicked();
        }
    }

    if (typeof QWebChannel !== 'undefined' && typeof qt !== 'undefined') {
        try {
            new QWebChannel(qt.webChannelTransport, function (channel) {
                window.bridge = channel.objects.bridge;
            });
        } catch (e) {
        }
    }

    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–æ–Ω–∞—Ö
    const ionInfo = {
        sodium: {
            title: "–ò–æ–Ω –Ω–∞—Ç—Ä–∏—è (Na‚Å∫)",
            content: `
                    <div class="info-section">
                        <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong>
                        <p>–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –∑–∞—Ä—è–∂–µ–Ω–Ω—ã–π –∏–æ–Ω (–∫–∞—Ç–∏–æ–Ω) –Ω–∞—Ç—Ä–∏—è, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–π –∞—Ç–æ–º–æ–º –Ω–∞—Ç—Ä–∏—è, –æ—Ç–¥–∞–≤—à–∏–º –æ–¥–∏–Ω —ç–ª–µ–∫—Ç—Ä–æ–Ω.</p>
                    </div>
                    <div class="info-section">
                        <strong>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</strong>
                        <p>‚Ä¢ –ó–∞—Ä—è–¥: +1<br>
                        ‚Ä¢ –ò–æ–Ω–Ω—ã–π —Ä–∞–¥–∏—É—Å: 95 –ø–º (–ø–∏–∫–æ–º–µ—Ç—Ä–æ–≤)<br>
                        ‚Ä¢ –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: 1s¬≤ 2s¬≤ 2p‚Å∂<br>
                        ‚Ä¢ –¶–≤–µ—Ç –≤ —Ä–µ—à—ë—Ç–∫–µ: —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π</p>
                    </div>
                    <div class="info-section">
                        <strong>–†–æ–ª—å –≤ –∫—Ä–∏—Å—Ç–∞–ª–ª–µ:</strong>
                        <p>–ö–∞–∂–¥—ã–π –∏–æ–Ω Na‚Å∫ –æ–∫—Ä—É–∂—ë–Ω 6 –∏–æ–Ω–∞–º–∏ Cl‚Åª –≤ –æ–∫—Ç–∞—ç–¥—Ä–∏—á–µ—Å–∫–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏. –ü—Ä–∏—Ç—è–∂–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –∑–∞—Ä—è–∂–µ–Ω–Ω—ã–º–∏ –∏–æ–Ω–∞–º–∏ Na‚Å∫ –∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ –∑–∞—Ä—è–∂–µ–Ω–Ω—ã–º–∏ Cl‚Åª —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ—á–Ω—É—é –∏–æ–Ω–Ω—É—é —Å–≤—è–∑—å.</p>
                    </div>
                    <div class="info-section">
                        <strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–æ–Ω–Ω–æ–µ —á–∏—Å–ª–æ:</strong>
                        <p>6 (–∫–∞–∂–¥—ã–π Na‚Å∫ –æ–∫—Ä—É–∂—ë–Ω 6 –±–ª–∏–∂–∞–π—à–∏–º–∏ Cl‚Åª)</p>
                    </div>
                `
        },
        chloride: {
            title: "–ò–æ–Ω —Ö–ª–æ—Ä–∞ (Cl‚Åª)",
            content: `
                    <div class="info-section">
                        <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong>
                        <p>–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ –∑–∞—Ä—è–∂–µ–Ω–Ω—ã–π –∏–æ–Ω (–∞–Ω–∏–æ–Ω) —Ö–ª–æ—Ä–∞, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–π –∞—Ç–æ–º–æ–º —Ö–ª–æ—Ä–∞, –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–≤—à–∏–º –æ–¥–∏–Ω —ç–ª–µ–∫—Ç—Ä–æ–Ω.</p>
                    </div>
                    <div class="info-section">
                        <strong>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</strong>
                        <p>‚Ä¢ –ó–∞—Ä—è–¥: ‚àí1<br>
                        ‚Ä¢ –ò–æ–Ω–Ω—ã–π —Ä–∞–¥–∏—É—Å: 181 –ø–º (–ø–∏–∫–æ–º–µ—Ç—Ä–æ–≤)<br>
                        ‚Ä¢ –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: 1s¬≤ 2s¬≤ 2p‚Å∂ 3s¬≤ 3p‚Å∂<br>
                        ‚Ä¢ –¶–≤–µ—Ç –≤ —Ä–µ—à—ë—Ç–∫–µ: –∑–µ–ª—ë–Ω—ã–π</p>
                    </div>
                    <div class="info-section">
                        <strong>–†–æ–ª—å –≤ –∫—Ä–∏—Å—Ç–∞–ª–ª–µ:</strong>
                        <p>–ö–∞–∂–¥—ã–π –∏–æ–Ω Cl‚Åª –æ–∫—Ä—É–∂—ë–Ω 6 –∏–æ–Ω–∞–º–∏ Na‚Å∫ –≤ –æ–∫—Ç–∞—ç–¥—Ä–∏—á–µ—Å–∫–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏. –ò–æ–Ω—ã —Ö–ª–æ—Ä–∞ –±–æ–ª—å—à–µ –ø–æ —Ä–∞–∑–º–µ—Ä—É, —á–µ–º –∏–æ–Ω—ã –Ω–∞—Ç—Ä–∏—è (181 –ø–º –ø—Ä–æ—Ç–∏–≤ 95 –ø–º).</p>
                    </div>
                    <div class="info-section">
                        <strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–æ–Ω–Ω–æ–µ —á–∏—Å–ª–æ:</strong>
                        <p>6 (–∫–∞–∂–¥—ã–π Cl‚Åª –æ–∫—Ä—É–∂—ë–Ω 6 –±–ª–∏–∂–∞–π—à–∏–º–∏ Na‚Å∫)</p>
                    </div>
                `
        },
        lattice: {
            title: "–ö—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è —Ä–µ—à—ë—Ç–∫–∞ NaCl",
            content: `
                    <div class="info-section">
                        <strong>–¢–∏–ø —Ä–µ—à—ë—Ç–∫–∏:</strong>
                        <p>–ì—Ä–∞–Ω–µ—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫—É–±–∏—á–µ—Å–∫–∞—è (–ì–¶–ö) —Ä–µ—à—ë—Ç–∫–∞. –¢–∞–∫–∂–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ—à—ë—Ç–∫–æ–π –∫–∞–º–µ–Ω–Ω–æ–π —Å–æ–ª–∏ –∏–ª–∏ —Ä–µ—à—ë—Ç–∫–æ–π —Ç–∏–ø–∞ NaCl.</p>
                    </div>
                    <div class="info-section">
                        <strong>–°—Ç—Ä—É–∫—Ç—É—Ä–∞:</strong>
                        <p>‚Ä¢ –ò–æ–Ω—ã Na‚Å∫ –∏ Cl‚Åª –æ–±—Ä–∞–∑—É—é—Ç –¥–≤–µ –≤–∑–∞–∏–º–æ–ø—Ä–æ–Ω–∏–∫–∞—é—â–∏–µ –ì–¶–ö –ø–æ–¥—Ä–µ—à—ë—Ç–∫–∏<br>
                        ‚Ä¢ –ö–∞–∂–¥—ã–π –∏–æ–Ω –æ–∫—Ä—É–∂—ë–Ω 6 –∏–æ–Ω–∞–º–∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ–≥–æ –∑–∞—Ä—è–¥–∞<br>
                        ‚Ä¢ –ü–∞—Ä–∞–º–µ—Ç—Ä —Ä–µ—à—ë—Ç–∫–∏ a = 5.64 √Ö<br>
                        ‚Ä¢ –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ Na-Cl = 2.82 √Ö</p>
                    </div>
                    <div class="info-section">
                        <strong>–ò–æ–Ω–Ω–∞—è —Å–≤—è–∑—å:</strong>
                        <p>–ö—É–ª–æ–Ω–æ–≤—Å–∫–æ–µ –ø—Ä–∏—Ç—è–∂–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–∞–∑–Ω–æ–∏–º—ë–Ω–Ω–æ –∑–∞—Ä—è–∂–µ–Ω–Ω—ã–º–∏ –∏–æ–Ω–∞–º–∏ —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ—á–Ω—É—é —Å–≤—è–∑—å. –≠–Ω–µ—Ä–≥–∏—è —Ä–µ—à—ë—Ç–∫–∏ NaCl —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 788 –∫–î–∂/–º–æ–ª—å.</p>
                    </div>
                    <div class="info-section">
                        <strong>–°–≤–æ–π—Å—Ç–≤–∞:</strong>
                        <p>‚Ä¢ –í—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–ª–∞–≤–ª–µ–Ω–∏—è (801¬∞C)<br>
                        ‚Ä¢ –•—Ä—É–ø–∫–æ—Å—Ç—å<br>
                        ‚Ä¢ –†–∞—Å—Ç–≤–æ—Ä–∏–º–æ—Å—Ç—å –≤ –≤–æ–¥–µ<br>
                        ‚Ä¢ –≠–ª–µ–∫—Ç—Ä–æ–ø—Ä–æ–≤–æ–¥–Ω–æ—Å—Ç—å –≤ —Ä–∞—Å–ø–ª–∞–≤–ª–µ–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏<br>
                        ‚Ä¢ –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–ª—è –≤–∏–¥–∏–º–æ–≥–æ —Å–≤–µ—Ç–∞</p>
                    </div>
                    <div class="info-section">
                        <strong>–î—Ä—É–≥–∏–µ –ø—Ä–∏–º–µ—Ä—ã:</strong>
                        <p>–¢–∞–∫—É—é –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–º–µ—é—Ç: LiF, KCl, MgO, CaO –∏ –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ –∏–æ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.</p>
                    </div>
                `
        }
    };

    // Three.js
    let scene, camera, renderer;
    let latticeGroup;
    let ions = {};
    let bonds = [];
    let raycaster, mouse;
    let selectedPart = null;
    let isDragging = false;
    let previousMousePosition = {x: 0, y: 0};
    let animationPaused = false;
    let showBonds = false;
    let currentLatticeSize = 3;

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a2e);

        camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(8, 8, 8);
        camera.lookAt(0, 0, 0);

        const container = document.getElementById('canvas-container');
        renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);

        // –û—Å–≤–µ—â–µ–Ω–∏–µ
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const light1 = new THREE.DirectionalLight(0xffffff, 0.8);
        light1.position.set(10, 10, 10);
        scene.add(light1);

        const light2 = new THREE.DirectionalLight(0xffffff, 0.5);
        light2.position.set(-10, 5, -5);
        scene.add(light2);

        const light3 = new THREE.PointLight(0x667eea, 0.6, 50);
        light3.position.set(0, 10, 0);
        scene.add(light3);

        latticeGroup = new THREE.Group();
        scene.add(latticeGroup);

        createLattice(currentLatticeSize);

        raycaster = new THREE.Raycaster();
        mouse = new THREE.Vector2();

        window.addEventListener('resize', onWindowResize);
        renderer.domElement.addEventListener('click', onMouseClick);
        renderer.domElement.addEventListener('mousemove', onMouseMove);
        renderer.domElement.addEventListener('mousedown', onMouseDown);
        renderer.domElement.addEventListener('mouseup', onMouseUp);
        renderer.domElement.addEventListener('wheel', onWheel);
        window.addEventListener('keydown', onKeyDown);

        animate();
    }

    function createLattice(size) {
        // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é —Ä–µ—à—ë—Ç–∫—É
        while (latticeGroup.children.length > 0) {
            latticeGroup.remove(latticeGroup.children[0]);
        }
        ions = {};
        bonds = [];

        const spacing = 1.2; // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∏–æ–Ω–∞–º–∏

        // –†–∞–¥–∏—É—Å—ã –∏–æ–Ω–æ–≤ (–≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö)
        const naRadius = 0.25; // Na‚Å∫ –º–µ–Ω—å—à–µ
        const clRadius = 0.45; // Cl‚Åª –±–æ–ª—å—à–µ

        // –°–æ–∑–¥–∞—ë–º –∫—É–±–∏—á–µ—Å–∫—É—é —Ä–µ—à—ë—Ç–∫—É NaCl
        for (let x = 0; x < size; x++) {
            for (let y = 0; y < size; y++) {
                for (let z = 0; z < size; z++) {
                    // Na‚Å∫ –≤ –ø–æ–∑–∏—Ü–∏—è—Ö –≥–¥–µ —Å—É–º–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —á—ë—Ç–Ω–∞—è
                    if ((x + y + z) % 2 === 0) {
                        createIon('sodium', x * spacing, y * spacing, z * spacing, naRadius);
                    }
                    // Cl‚Åª –≤ –ø–æ–∑–∏—Ü–∏—è—Ö –≥–¥–µ —Å—É–º–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ω–µ—á—ë—Ç–Ω–∞—è
                    else {
                        createIon('chloride', x * spacing, y * spacing, z * spacing, clRadius);
                    }
                }
            }
        }

        // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ä–µ—à—ë—Ç–∫—É
        const offset = (size - 1) * spacing / 2;
        latticeGroup.position.set(-offset, -offset, -offset);

        // –°–æ–∑–¥–∞—ë–º —Å–≤—è–∑–∏ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã
        if (showBonds) {
            createBonds(size, spacing);
        }
    }

    function createIon(type, x, y, z, radius) {
        const geometry = new THREE.SphereGeometry(radius, 32, 32);

        let material;
        if (type === 'sodium') {
            material = new THREE.MeshPhongMaterial({
                color: 0x9b59b6,
                emissive: 0x8e44ad,
                emissiveIntensity: 0.2,
                shininess: 100,
                specular: 0xffffff,
                transparent: true,
                opacity: 0.9
            });
        } else {
            material = new THREE.MeshPhongMaterial({
                color: 0x2ecc71,
                emissive: 0x27ae60,
                emissiveIntensity: 0.2,
                shininess: 100,
                specular: 0xffffff,
                transparent: true,
                opacity: 0.9
            });
        }

        const ion = new THREE.Mesh(geometry, material);
        ion.position.set(x, y, z);
        ion.userData = {
            type: type,
            gridPos: {x, y, z}
        };

        latticeGroup.add(ion);

        const key = `${type}_${x}_${y}_${z}`;
        ions[key] = ion;

        // –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–µ—á–µ–Ω–∏–µ
        const glowGeom = new THREE.SphereGeometry(radius * 1.3, 16, 16);
        const glowMat = new THREE.MeshBasicMaterial({
            color: type === 'sodium' ? 0x9b59b6 : 0x2ecc71,
            transparent: true,
            opacity: 0.15
        });
        const glow = new THREE.Mesh(glowGeom, glowMat);
        ion.add(glow);
    }

    function createBonds(size, spacing) {
        const bondMaterial = new THREE.LineBasicMaterial({
            color: 0xffffff,
            transparent: true,
            opacity: 0.3
        });

        // –°–æ–∑–¥–∞—ë–º —Å–≤—è–∑–∏ –º–µ–∂–¥—É –±–ª–∏–∂–∞–π—à–∏–º–∏ —Ä–∞–∑–Ω–æ–∏–º—ë–Ω–Ω—ã–º–∏ –∏–æ–Ω–∞–º–∏
        for (let x = 0; x < size; x++) {
            for (let y = 0; y < size; y++) {
                for (let z = 0; z < size; z++) {
                    const isNa = (x + y + z) % 2 === 0;

                    if (isNa) {
                        // –î–ª—è –∫–∞–∂–¥–æ–≥–æ Na‚Å∫ –Ω–∞—Ö–æ–¥–∏–º 6 –±–ª–∏–∂–∞–π—à–∏—Ö Cl‚Åª
                        const neighbors = [
                            [x + 1, y, z],
                            [x - 1, y, z],
                            [x, y + 1, z],
                            [x, y - 1, z],
                            [x, y, z + 1],
                            [x, y, z - 1]
                        ];

                        neighbors.forEach(([nx, ny, nz]) => {
                            if (nx >= 0 && nx < size && ny >= 0 && ny < size && nz >= 0 && nz < size) {
                                const points = [];
                                points.push(new THREE.Vector3(x * spacing, y * spacing, z * spacing));
                                points.push(new THREE.Vector3(nx * spacing, ny * spacing, nz * spacing));

                                const geometry = new THREE.BufferGeometry().setFromPoints(points);
                                const line = new THREE.Line(geometry, bondMaterial);
                                latticeGroup.add(line);
                                bonds.push(line);
                            }
                        });
                    }
                }
            }
        }
    }

    function setLatticeSize(size) {
        currentLatticeSize = size;
        createLattice(size);

        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
        document.querySelectorAll('.view-btn').forEach((btn, i) => {
            if (i < 3) {
                btn.classList.toggle('active', i === size - 3);
            }
        });
    }

    function toggleBonds() {
        showBonds = !showBonds;

        if (showBonds) {
            createLattice(currentLatticeSize);
        } else {
            // –£–¥–∞–ª—è–µ–º —Å–≤—è–∑–∏
            bonds.forEach(bond => latticeGroup.remove(bond));
            bonds = [];
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É
        document.querySelectorAll('.view-btn')[3].classList.toggle('active', showBonds);
    }

    function onMouseDown(e) {
        isDragging = true;
        previousMousePosition = {x: e.clientX, y: e.clientY};
    }

    function onMouseUp() {
        isDragging = false;
    }

    function onMouseMove(e) {
        mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;

        if (isDragging) {
            const deltaX = e.clientX - previousMousePosition.x;
            const deltaY = e.clientY - previousMousePosition.y;
            latticeGroup.rotation.y += deltaX * 0.005;
            latticeGroup.rotation.x += deltaY * 0.005;
            previousMousePosition = {x: e.clientX, y: e.clientY};
        }

        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(Object.values(ions));
        document.body.style.cursor = intersects.length > 0 ? 'pointer' : 'default';
    }

    function onMouseClick(e) {
        mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;

        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(Object.values(ions));

        if (intersects.length > 0) {
            const ion = intersects[0].object;
            const type = ion.userData.type;
            showInfo(type);
            highlightPart(ion);
        } else {
            // –ö–ª–∏–∫ –ø–æ –ø—É—Å—Ç–æ–º—É –º–µ—Å—Ç—É - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ—à—ë—Ç–∫–µ
            showInfo('lattice');
        }
    }

    function onWheel(e) {
        e.preventDefault();
        const delta = e.deltaY * 0.01;
        camera.position.multiplyScalar(1 + delta * 0.1);

        const distance = camera.position.length();
        if (distance < 5) camera.position.setLength(5);
        if (distance > 30) camera.position.setLength(30);
    }

    function onKeyDown(e) {
        if (e.code === 'Space') {
            e.preventDefault();
            animationPaused = !animationPaused;
        }
    }

    function showInfo(type) {
        const info = ionInfo[type];
        if (info) {
            document.getElementById('info-title').textContent = info.title;
            document.getElementById('info-content').innerHTML = info.content;
            document.getElementById('info-panel').classList.add('active');
        }
    }

    function closeInfo() {
        document.getElementById('info-panel').classList.remove('active');
        if (selectedPart) {
            const originalColor = selectedPart.userData.type === 'sodium' ? 0x8e44ad : 0x27ae60;
            selectedPart.material.emissive.setHex(originalColor);
            selectedPart.material.emissiveIntensity = 0.2;
            selectedPart = null;
        }
    }

    function highlightPart(ion) {
        if (selectedPart) {
            const originalColor = selectedPart.userData.type === 'sodium' ? 0x8e44ad : 0x27ae60;
            selectedPart.material.emissive.setHex(originalColor);
            selectedPart.material.emissiveIntensity = 0.2;
        }
        ion.material.emissive.setHex(0xffffff);
        ion.material.emissiveIntensity = 0.6;
        selectedPart = ion;
    }

    function focusPart(type) {
        showInfo(type);
        // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–≤—ã–π –∏–æ–Ω —ç—Ç–æ–≥–æ —Ç–∏–ø–∞
        const ion = Object.values(ions).find(i => i.userData.type === type);
        if (ion) highlightPart(ion);
    }

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
        requestAnimationFrame(animate);

        if (!animationPaused) {
            latticeGroup.rotation.y += 0.003;
        }

        renderer.render(scene, camera);
    }

    window.addEventListener('load', init);
</script>
</body>
</html>